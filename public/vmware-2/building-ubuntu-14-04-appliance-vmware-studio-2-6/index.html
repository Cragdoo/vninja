<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Building an Ubuntu 14.04 Appliance with VMware Studio 2.6  &middot; Adventures in Hugo</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="There is a thin line between agile and fragile" />

<meta name="keywords" content="Appliance, Hack, Ubuntu, Unsupported, VMware Studio, ">


<meta property="og:title" content="Building an Ubuntu 14.04 Appliance with VMware Studio 2.6  &middot; Adventures in Hugo ">
<meta property="og:site_name" content="Adventures in Hugo"/>
<meta property="og:url" content="/vmware-2/building-ubuntu-14-04-appliance-vmware-studio-2-6/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-10-07T23:26:03Z" />
<meta property="og:article:modified_time" content="2014-10-07T23:26:03Z" />

  
    
<meta property="og:article:tag" content="Appliance">
    
<meta property="og:article:tag" content="Hack">
    
<meta property="og:article:tag" content="Ubuntu">
    
<meta property="og:article:tag" content="Unsupported">
    
<meta property="og:article:tag" content="VMware Studio">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="Building an Ubuntu 14.04 Appliance with VMware Studio 2.6" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="/vmware-2/building-ubuntu-14-04-appliance-vmware-studio-2-6/" />
<meta name="twitter:domain" content="/">
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Building an Ubuntu 14.04 Appliance with VMware Studio 2.6",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-10-07",
    "description": "",
    "wordCount": 593
  }
</script>
  



<link rel="canonical" href="/vmware-2/building-ubuntu-14-04-appliance-vmware-studio-2-6/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
<link rel="icon" href="/favicon.png">
<meta name="generator" content="Hugo 0.40.3" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="/css/bootswatch/default/bootstrap.min.css">


<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">




  <link rel="stylesheet" href="/css/highlight/default.css">


</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
          
          <a class="navbar-brand-img" href="/">
            <img alt="" src="">
            
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>





<div class="container">
  <div class="row">
    <div class="col-sm-12">


      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" >
<header class="container hat">
  <h1>Building an Ubuntu 14.04 Appliance with VMware Studio 2.6
</h1>

</header>
</div>


      <div class="content">
  

<p>VMware Studio 2.6 was released way back in March 2012,  and surprisingly there seems to be no new update in sight. While VMware Studio technically still works, even with newer versions of ESXi and vCenter, the supported operating systems for the appliances it can build is <em>somewhat</em> outdated:</p>

<ul>
<li><p>Red Hat Enterprise Linux 5.<sup>5</sup>&frasl;<sub>6</sub>.0</p></li>

<li><p>SUSE Linux Enterprise Server 10.<sup>2</sup>&frasl;<sub>11</sub>.1</p></li>

<li><p>Ubuntu 8.04.<sup>4</sup>&frasl;<sub>10</sub>.04.1</p></li>

<li><p>Windows Server 2003 R2 / 2008 R2 w/SP1</p></li>
</ul>

<h3 id="the-problem">The Problem:</h3>

<p>For a yet to be announced project we are working on internally at EVRY, we needed to build an appliance that was based on newer software packages and development tools. Recent events like heartbleed and shellshock also highlight the need to build new appliances on new and supported distributions.</p>

<p>Attempts at upgrading an existing Ubuntu 10.04.1 appliance to 14.04 failed miserably, due to architectural changes between the Ubuntu versions and how Virtual Appliance Management Infrastructure (VAMI) is installed by VMware Studio and in the end we were pretty much left to two options:</p>

<ol>
<li><p>Build the appliance from scratch, and lose VAMI, which was one of the primary reasons for building the appliance with VMware Studio in the first place.</p></li>

<li><p>Find a way to build the appliance with Ubuntu 14.04, with VMware Studio.</p></li>
</ol>

<p>Option 1 felt a bit like giving up, and option 2, well that was a challenge we couldn&rsquo;t just walk away from.</p>

<h3 id="the-solution">The Solution:</h3>

<p>Thanks to the brilliant mind of my coworker <a href="http://twitter.com/esodesod">Espen Ødegaard,</a> we were able to come up with a set of solutions that does the trick.</p>

<p>First we added a new profile to VMware Studio connecting to the VMware Studio VM via SSH, and by issuing the following command:
[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;1&rdquo;]
studiocli &ndash;newos &ndash;osdesc &ldquo;Ubuntu14.04” &ndash;profile /opt/vmware/etc/build/templates/ubuntu/10/041/build_profile.xml
[/cc]
Basically this creates a new OS template in VMware Studio by copying the existing Ubuntu 10.04.1 profile.</p>

<p>Next edit line 462 in <em>/opt/vmware/etc/build/templates/Ubuntu14.04/Ubuntu14.04.xsl</em> and change <em>scd0</em> to <em>sr0</em>.</p>

<p>[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]
if ! mount -t iso9660 -r /dev/scd0 /target/${cdrom_dir} ; then <br />
if ! mount -t iso9660 -r /dev/hda /target/${cdrom_dir} ; then <br />
cdrom_mounted=0; <br />
fi ; <br />
[/cc]</p>

<p>This fixes a problem with the appliance not being able to mount the Ubuntu installation iso when it is built. Place the Ubuntu 14.04 ISO in<em> /opt/vmware/www/ISV/ISO</em>, and create a new Build profile using the VMware Studio Web Interface.</p>

<p>Now, before an appliance can be built, we need to fix some other problems that prevent VAMI from starting up, and preventing login to the VAMI web interface. First of, make sure that <em>libncurses5</em> is added as package under <strong>Application</strong> -&gt; <strong>List of packages from OS install media</strong>. Next, add the following to the <em>first boot script</em> under <strong>OS</strong>-&gt;<strong>Boot Customization</strong>, we can move around those problems.</p>

<p>[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]</p>

<h1 id="create-symlinks-required-for-ubuntu-14-04-and-vami">Create symlinks required for Ubuntu 14.04 and VAMI</h1>

<h1 id="copy-and-symlink-libncurses-to-the-location-vami-looks-for-them">Copy and symlink libncurses to the location VAMI looks for them</h1>

<p>cp /lib/i386-linux-gnu/libncurses.so.5.9 /opt/vmware/lib/
rm /opt/vmware/lib/libncurses.so.5
ln -s /opt/vmware/lib/libncurses.so.5.9 /opt/vmware/lib/libncurses.so.5</p>

<h1 id="symlink-pam-libraries-in-order-for-them-to-work-with-vami">Symlink PAM libraries in order for them to work with VAMI</h1>

<h1 id="this-unbreaks-authentication-in-the-web-interface">This &ldquo;unbreaks&rdquo; authentication in the web interface</h1>

<p>mkdir /lib/security
ln -s /lib/i386-linux-gnu/security/* /lib/security/
[/cc]</p>

<p>For details on how all of this works, and how to create build profiles, check the official <a href="https://www.vmware.com/support/developer/studio/studio26/studio_developer.pdf">VMware Studio documentation</a>.</p>

<p>The build process should now complete successfully, and you should have an Ubuntu 14.04 based appliance built with VMware Studio!
<img src="http://vninja.net/wordpress/wp-content/uploads/2014/10/vStealth1.png" alt="vStealth1" />
<img src="http://vninja.net/wordpress/wp-content/uploads/2014/10/vStealth2.png" alt="vStealth2" /></p>

<p><em>Note that all of this is completely unsupported by VMware, and you are pretty much on your own. Hopefully there will be a new version of VMware Studio available soon, and we won&rsquo;t have to rely on unsupported hacks to get it working with newer operating systems.</em></p>

</div>


      
    </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
</small>
</div>


    
<div class="container copyright">
    <small>
  &copy; Christian Mohn

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="//s3.amazonaws.com/mailmunch/static/site.js" id="mailmunch-script" data-mailmunch-site-id="" async="async"></script>



<script src="//load.sumome.com/" data-sumo-site-id="" async="async"></script>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


<script src="/js/highlight.pack.js"></script>
<script src="/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
var ENABLE_POPOVER = "", 
EXPIRE_COOKIE = "", 
SHOW_MODAL_TIMEOUT = "", 
MOUSE_LEAVE = "", 
MODAL_SIZE = "", 
POST_URL = "", 
SIGNUP_HEADER = "",
HEADER_IMAGE = "",
IMG_DESCRIPTION = "",
SIGNUP_TEXT = "",
INPUT_PLACEHOLDER = "",
SUBMIT_BUTTON = "",
SUCCESS_MESSAGE = "",
ERROR_MESSAGE = "",
OPTIN = "",
COOKIE_NAME = "",
CONTENTLANGUAGE = ""; 
</script>





<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

