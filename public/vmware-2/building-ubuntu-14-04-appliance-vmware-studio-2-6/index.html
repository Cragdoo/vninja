<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Building an Ubuntu 14.04 Appliance with VMware Studio 2.6  &middot; vNinja.net</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="Appliance, Hack, Ubuntu, Unsupported, VMware Studio, ">

<link rel="author" href="http://plus.google.com/+Myprofile">


<meta property="og:title" content="Building an Ubuntu 14.04 Appliance with VMware Studio 2.6  &middot; vNinja.net ">
<meta property="og:site_name" content="vNinja.net"/>
<meta property="og:url" content="https://vninja.net/vmware-2/building-ubuntu-14-04-appliance-vmware-studio-2-6/" />
<meta property="og:locale" content="en">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-10-07T23:26:03Z" />
<meta property="og:article:modified_time" content="2014-10-07T23:26:03Z" />

  
    
<meta property="og:article:tag" content="Appliance">
    
<meta property="og:article:tag" content="Hack">
    
<meta property="og:article:tag" content="Ubuntu">
    
<meta property="og:article:tag" content="Unsupported">
    
<meta property="og:article:tag" content="VMware Studio">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@h0bbel" />
<meta name="twitter:creator" content="@h0bbel" />
<meta name="twitter:title" content="Building an Ubuntu 14.04 Appliance with VMware Studio 2.6" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://vninja.net/vmware-2/building-ubuntu-14-04-appliance-vmware-studio-2-6/" />
<meta name="twitter:domain" content="https://vninja.net">
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Building an Ubuntu 14.04 Appliance with VMware Studio 2.6",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+Myprofile?rel=author"
    },
    "datePublished": "2014-10-07",
    "description": "",
    "wordCount": 583
  }
</script>
  



<link rel="canonical" href="https://vninja.net/vmware-2/building-ubuntu-14-04-appliance-vmware-studio-2-6/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://vninja.net/touch-icon-144-precomposed.png">
<link rel="icon" href="https://vninja.net/favicon.png">
<meta name="generator" content="Hugo 0.42.2" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="https://vninja.net/css/bootswatch/yeti/bootstrap.min.css">


<link rel="stylesheet" href="https://vninja.net/css/font-awesome.min.css">
<link rel="stylesheet" href="https://vninja.net/css/style.css">


<link rel="stylesheet" href="https://vninja.net/css/style_custom.css">



  <link rel="stylesheet" href="https://vninja.net/css/highlight/default.css">


  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
  <script>
  window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    "palette": {
      "popup": {
        "background": "#efefef",
        "text": "#404040"
      },
      "button": {
        "background": "#8ec760",
        "text": "#ffffff"
      }
    },
    "showLink": false,
    "position": "bottom-right"
  })});
  </script>
</script>




</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
        <a class="navbar-brand" href="https://vninja.net/">
          vNinja.net
          
          
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            <li class="">
              
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class='fa fa-bars'></i> About <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    
                      <li class="">
                        <a href="https://vninja.net/about/christian-mohn/"><i class='fa fa-child'></i> About Christian</a>
                      </li>
                    
                  </ul>
              
            </li>
            
            <li class="">
              
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class='fa fa-asterisk'></i> Site Policy <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    
                      <li class="">
                        <a href="https://vninja.net/about/privacy-policy"><i class='fa fa-asterisk'></i> Privacy Policy</a>
                      </li>
                    
                  </ul>
              
            </li>
            
            <li class="">
              
                <a href="https://vninja.net/advertising" >
                  <i class='fa fa-bank'></i>
                  Advertising
                </a>
              
            </li>
            
            <li class="">
              
                <a href="https://vninja.net/post/index.xml" >
                  <i class='fa fa-rss'></i>
                  RSS
                </a>
              
            </li>
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>





<div class="container">
  <div class="row">
    <div class="col-sm-9">


      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="title-metas text-center">

    <h1>Building an Ubuntu 14.04 Appliance with VMware Studio 2.6
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2014-10-07">7 Oct, 2014</time>
</small>


  <small>
    &middot; by Christian Mohn
  
  &middot; Read in about 3 min
  &middot; (583 words)
  &middot; 


  </small>

<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="https://vninja.net/tags/appliance" class="label label-primary">Appliance</a>
  
  <a href="https://vninja.net/tags/hack" class="label label-primary">Hack</a>
  
  <a href="https://vninja.net/tags/ubuntu" class="label label-primary">Ubuntu</a>
  
  <a href="https://vninja.net/tags/unsupported" class="label label-primary">Unsupported</a>
  
  <a href="https://vninja.net/tags/vmware-studio" class="label label-primary">VMware Studio</a>
  


</div>

<br>
</div>

  </div>
</div>


      <div class="content">

  

  <p>VMware Studio 2.6 was released way back in March 2012,  and surprisingly there seems to be no new update in sight. While VMware Studio technically still works, even with newer versions of ESXi and vCenter, the supported operating systems for the appliances it can build is <em>somewhat</em> outdated:</p>

<p></p>

<ul>
<li><p>Red Hat Enterprise Linux 5.5/6.0</p></li>

<li><p>SUSE Linux Enterprise Server 10.2/11.1</p></li>

<li><p>Ubuntu 8.04.4/10.04.1</p></li>

<li><p>Windows Server 2003 R2 / 2008 R2 w/SP1</p></li>
</ul>

<h3 id="the-problem">The Problem:</h3>

<p>For a yet to be announced project we are working on internally at EVRY, we needed to build an appliance that was based on newer software packages and development tools. Recent events like heartbleed and shellshock also highlight the need to build new appliances on new and supported distributions.</p>

<p>Attempts at upgrading an existing Ubuntu 10.04.1 appliance to 14.04 failed miserably, due to architectural changes between the Ubuntu versions and how Virtual Appliance Management Infrastructure (VAMI) is installed by VMware Studio and in the end we were pretty much left to two options:</p>

<ol>
<li><p>Build the appliance from scratch, and lose VAMI, which was one of the primary reasons for building the appliance with VMware Studio in the first place.</p></li>

<li><p>Find a way to build the appliance with Ubuntu 14.04, with VMware Studio.</p></li>
</ol>

<p>Option 1 felt a bit like giving up, and option 2, well that was a challenge we couldn&rsquo;t just walk away from.</p>

<h3 id="the-solution">The Solution:</h3>

<p>Thanks to the brilliant mind of my coworker <a href="http://twitter.com/esodesod">Espen Ødegaard,</a> we were able to come up with a set of solutions that does the trick.</p>

<p>First we added a new profile to VMware Studio connecting to the VMware Studio VM via SSH, and by issuing the following command:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">studiocli --newos --osdesc <span style="color:#e6db74">&#34;Ubuntu14.04” --profile /opt/vmware/etc/build/templates/ubuntu/10/041/build_profile.xml</span></code></pre></div>
Basically this creates a new OS template in VMware Studio by copying the existing Ubuntu 10.04.1 profile.</p>

<p>Next edit line 462 in <em>/opt/vmware/etc/build/templates/Ubuntu14.04/Ubuntu14.04.xsl</em> and change <em>scd0</em> to <em>sr0</em>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">if</span> ! mount -t iso9660 -r /dev/scd0 /target/<span style="color:#e6db74">${</span>cdrom_dir<span style="color:#e6db74">}</span> ; <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#66d9ef">if</span> ! mount -t iso9660 -r /dev/hda /target/<span style="color:#e6db74">${</span>cdrom_dir<span style="color:#e6db74">}</span> ; <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>cdrom_mounted<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#66d9ef">fi</span> ; <span style="color:#960050;background-color:#1e0010">\</span></code></pre></div>

<p>This fixes a problem with the appliance not being able to mount the Ubuntu installation iso when it is built. Place the Ubuntu 14.04 ISO in<em> /opt/vmware/www/ISV/ISO</em>, and create a new Build profile using the VMware Studio Web Interface.</p>

<p>Now, before an appliance can be built, we need to fix some other problems that prevent VAMI from starting up, and preventing login to the VAMI web interface. First of, make sure that <em>libncurses5</em> is added as package under <strong>Application</strong> -&gt; <strong>List of packages from OS install media</strong>. Next, add the following to the <em>first boot script</em> under <strong>OS</strong>-&gt;<strong>Boot Customization</strong>, we can move around those problems.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Create symlinks required for Ubuntu 14.04 and VAMI
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Copy and symlink libncurses to the location VAMI looks for them
</span><span style="color:#75715e"></span>
cp /lib/i386-linux-gnu/libncurses.so.5.9 /opt/vmware/lib/
rm /opt/vmware/lib/libncurses.so.5
ln -s /opt/vmware/lib/libncurses.so.5.9 /opt/vmware/lib/libncurses.so.5

<span style="color:#75715e"># Symlink PAM libraries in order for them to work with VAMI
</span><span style="color:#75715e"># This &#34;unbreaks&#34; authentication in the web interface
</span><span style="color:#75715e"></span>mkdir /lib/security
ln -s /lib/i386-linux-gnu/security/* /lib/security/</code></pre></div>

<p>For details on how all of this works, and how to create build profiles, check the official <a href="https://www.vmware.com/support/developer/studio/studio26/studio_developer.pdf">VMware Studio documentation</a>.</p>

<p>The build process should now complete successfully, and you should have an Ubuntu 14.04 based appliance built with VMware Studio!
<img src="https://vninja.net/img/vStealth1.png" alt="vStealth1" />
<img src="https://vninja.net/img/vStealth2.png" alt="vStealth2" /></p>

<p><em>Note that all of this is completely unsupported by VMware, and you are pretty much on your own. Hopefully there will be a new version of VMware Studio available soon, and we won&rsquo;t have to rely on unsupported hacks to get it working with newer operating systems.</em></p>
</div>


      <footer>
  


  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://vninja.net/rant/hyperconverged-be-all-end-all-no/" title="Is Hyperconverged the be-all, end-all? No.">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://vninja.net/virtualization/nordic-vmug-conference-2014/" title="Nordic VMUG Conference 2014">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  

</div>

</footer>

    </div>
    
      <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div>
  

    <div class="section">
      <h4>Sponsors</h4>
      <div class="ads" id="veeam">
        <ins class='dcmads' style='display:inline-block;width:250px;height:250px' data-dcm-placement='N410401.1772869VNINJA.NET/B10464038.145283149' data-dcm-rendering-mode='iframe' data-dcm-https-only data-dcm-resettable-device-id='' data-dcm-app-id=''> <script src='https://www.googletagservices.com/dcm/dcmads.js'></script> </ins>
      </div>
      <div class="ads" id="turbonomic">
        <a href="http://turbonomic.com/resources/hybrid-cloud-intelligent-bursting-aws-microsoft-azure/?utm_source=vninja&amp;utm_medium=banner-ad&amp;utm_campaign=wp-path-to-hybrid-cloud&amp;">
          <img width="250" height="250" src="https://vninja.net/ads/wp-intelligent-bursting-aws-azure-250x250.png"></a>
      </div>
      <div class="ads" id="goliath">
        <a href="http://goliathtechnologies.com/performance-monitoring/application-desktop-virtualization/vmware-horizon-view-monitoring/?utm_source=VNINJA&#038;utm_medium=PARTNER-MKTG&#038;utm_campaign=PARTNER-MKTG-VNINJA"><img width="250" height="250" src='https://vninja.net/ads/VMwareHorizon.jpg' alt='' title='VMwareHorizon' /></a>
      </div>
      <div class="ads" id="vembu">
        <a href="https://www.vembu.com/free-vm-backup/?utm_source=vninja.net&#038;utm_medium=Banner"><img width="250" height="250" src='https://vninja.net/ads/vembu250-250.gif'/></a>
      </div>


    </div>

    <hr>
    
      
      
      <div class="section">


      </div>
      
    
      
      
    

</div>

      </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

<a href="https://vninja.net/disclaimer/">Disclaimer</a> <i>&middot;</i>

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
  Built with Hugo and lots of <i class='fa fa-coffee'></i>

</small>
</div>


    
<div class="container copyright">
    <small>
  &copy; 2018 Christian Mohn

  </small>
</div>




        </div>
    </div>
  </div>
</footer>

    

<script src="https://vninja.net/js/jquery.min.js"></script>
<script src="https://vninja.net/js/bootstrap.min.js"></script>


<script src="https://vninja.net/js/highlight.pack.js"></script>
<script src="https://vninja.net/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-121910549-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER = "", 
EXPIRE_COOKIE = "", 
SHOW_MODAL_TIMEOUT = "", 
MOUSE_LEAVE = "", 
MODAL_SIZE = "", 
POST_URL = "", 
SIGNUP_HEADER = "",
HEADER_IMAGE = "",
IMG_DESCRIPTION = "",
SIGNUP_TEXT = "",
INPUT_PLACEHOLDER = "",
SUBMIT_BUTTON = "",
SUCCESS_MESSAGE = "",
ERROR_MESSAGE = "",
OPTIN = "",
COOKIE_NAME = "",
CONTENTLANGUAGE = ""; 
</script>










  </body>
</html>

