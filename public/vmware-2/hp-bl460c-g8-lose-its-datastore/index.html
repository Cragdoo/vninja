<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Why Did the HP BL460c G8 Lose It&#39;s Datastore?  &middot; vNinja.net</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="BL460c, c3000, c7000, ESXi, G8, HP, P220i, Patch, ProLiant, Update, VMware, ">

<link rel="author" href="http://plus.google.com/+Myprofile">


<meta property="og:title" content="Why Did the HP BL460c G8 Lose It&#39;s Datastore?  &middot; vNinja.net ">
<meta property="og:site_name" content="vNinja.net"/>
<meta property="og:url" content="https://vninja.net/vmware-2/hp-bl460c-g8-lose-its-datastore/" />
<meta property="og:locale" content="en">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2012-10-29T21:48:08Z" />
<meta property="og:article:modified_time" content="2012-10-29T21:48:08Z" />

  
    
<meta property="og:article:tag" content="BL460c">
    
<meta property="og:article:tag" content="c3000">
    
<meta property="og:article:tag" content="c7000">
    
<meta property="og:article:tag" content="ESXi">
    
<meta property="og:article:tag" content="G8">
    
<meta property="og:article:tag" content="HP">
    
<meta property="og:article:tag" content="P220i">
    
<meta property="og:article:tag" content="Patch">
    
<meta property="og:article:tag" content="ProLiant">
    
<meta property="og:article:tag" content="Update">
    
<meta property="og:article:tag" content="VMware">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@h0bbel" />
<meta name="twitter:creator" content="@h0bbel" />
<meta name="twitter:title" content="Why Did the HP BL460c G8 Lose It&#39;s Datastore?" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://vninja.net/vmware-2/hp-bl460c-g8-lose-its-datastore/" />
<meta name="twitter:domain" content="https://vninja.net">
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Why Did the HP BL460c G8 Lose It&#39;s Datastore?",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+Myprofile?rel=author"
    },
    "datePublished": "2012-10-29",
    "description": "",
    "wordCount": 884
  }
</script>
  



<link rel="canonical" href="https://vninja.net/vmware-2/hp-bl460c-g8-lose-its-datastore/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://vninja.net/touch-icon-144-precomposed.png">
<link rel="icon" href="https://vninja.net/favicon.png">
<meta name="generator" content="Hugo 0.42.2" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="https://vninja.net/css/bootswatch/yeti/bootstrap.min.css">


<link rel="stylesheet" href="https://vninja.net/css/font-awesome.min.css">
<link rel="stylesheet" href="https://vninja.net/css/style.css">


<link rel="stylesheet" href="https://vninja.net/css/style_custom.css">



  <link rel="stylesheet" href="https://vninja.net/css/highlight/default.css">


  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
  <script>
  window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    "palette": {
      "popup": {
        "background": "#efefef",
        "text": "#404040"
      },
      "button": {
        "background": "#8ec760",
        "text": "#ffffff"
      }
    },
    "showLink": false,
    "position": "bottom-right"
  })});
  </script>
</script>




</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
        <a class="navbar-brand" href="https://vninja.net/">
          vNinja.net
          
          
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            <li class="">
              
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class='fa fa-bars'></i> About <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    
                      <li class="">
                        <a href="https://vninja.net/about/christian-mohn/"><i class='fa fa-child'></i> About Christian</a>
                      </li>
                    
                  </ul>
              
            </li>
            
            <li class="">
              
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class='fa fa-asterisk'></i> Site Policy <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    
                      <li class="">
                        <a href="https://vninja.net/about/privacy-policy"><i class='fa fa-asterisk'></i> Privacy Policy</a>
                      </li>
                    
                  </ul>
              
            </li>
            
            <li class="">
              
                <a href="https://vninja.net/advertising" >
                  <i class='fa fa-bank'></i>
                  Advertising
                </a>
              
            </li>
            
            <li class="">
              
                <a href="https://vninja.net/post/index.xml" >
                  <i class='fa fa-rss'></i>
                  RSS
                </a>
              
            </li>
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>





<div class="container">
  <div class="row">
    <div class="col-sm-9">


      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="title-metas text-center">

    <h1>Why Did the HP BL460c G8 Lose It&#39;s Datastore?
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2012-10-29">29 Oct, 2012</time>
</small>


  <small>
    &middot; by Christian Mohn
  
  &middot; Read in about 5 min
  &middot; (884 words)
  &middot; 


  </small>

<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="https://vninja.net/tags/bl460c" class="label label-primary">BL460c</a>
  
  <a href="https://vninja.net/tags/c3000" class="label label-primary">c3000</a>
  
  <a href="https://vninja.net/tags/c7000" class="label label-primary">c7000</a>
  
  <a href="https://vninja.net/tags/esxi" class="label label-primary">ESXi</a>
  
  <a href="https://vninja.net/tags/g8" class="label label-primary">G8</a>
  
  <a href="https://vninja.net/tags/hp" class="label label-primary">HP</a>
  
  <a href="https://vninja.net/tags/p220i" class="label label-primary">P220i</a>
  
  <a href="https://vninja.net/tags/patch" class="label label-primary">Patch</a>
  
  <a href="https://vninja.net/tags/proliant" class="label label-primary">ProLiant</a>
  
  <a href="https://vninja.net/tags/update" class="label label-primary">Update</a>
  
  <a href="https://vninja.net/tags/vmware" class="label label-primary">VMware</a>
  


</div>

<br>
</div>

  </div>
</div>


      <div class="content">

  

  <p>Post Update:
As per <a href="http://vcp5.wordpress.com">Preetam´s</a> <a href="http://vninja.net/vmware-2/hp-bl460c-g8-lose-its-datastore/#comment-12163">comment</a>, HP has published a <a href="http://h20000.www2.hp.com/bizsupport/TechSupport/Document.jsp?objectID=c03603069&amp;jumpid=em_alerts_us-us_Dec12_xbu_all_all_1990986_137282_proliantserversbladesystem_critical_006_0">customer advisory regarding the usage of install vs update</a>.</p>

<p><img src="https://vninja.net/img/IMG_3814-2-300x225.jpg" alt="HP BL 460c G8" /></p>

<p>After installing a couple of brand new <strong>HP ProLiant BL460c G8</strong> blades with <strong>HP Smart Array P220i</strong> controllers at a customer site, I decided that I should upgrade from the <a href="https://my.vmware.com/web/vmware/details?downloadGroup=HP-ESXI-5.0.0-U1-15MAR2012&amp;productId=229">VMware-ESXi-5.0.0-Update1-623860-HP-5.20.43.iso</a> Build <em>623860</em> used to install the blades, to the latest <em>821926</em> <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2032584">build offered by VMware</a>.</p>

<p>Normally this is a really easy process using VMware Update Manager, but since this is a new installation all the prerequisites for that are not in place just yet and I decided to use <em>esxcli</em> to perform the update.</p>

<p>After placing the downloaded <em>ESXi500-201209001.zip</em> VIB file on the local datastore on the first host, I ran the update with the following command: (abbreviated for legibility)</p>

<p>[cc lang=&laquo;bash&raquo; width=&laquo;95%&raquo; theme=&laquo;blackboard&raquo; nowrap=&laquo;0&raquo;]
~ # esxcli software vib install -d /vmfs/volumes/datastore1/ESXi500-201209001.zip
Installation Result
Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.
Reboot Required: true
VIBs Installed: [&hellip;]
VIBs Removed: [&hellip;]
~ #
[/cc]</p>

<p>So far so good! One quick, as quick as a HP blade can, reboot later my host was updated to <em>ESXi 5.0.0 Build 821926</em> and everything looked fine. That is, until I wanted to put some new files into the blades local storage. Much to my surprise, there was no local storage to be seen at all. Thinking that something must have gone wrong while booting, I decided to try a new restart and imagine my surprise when the blade booted up again, but this time with <em>Build 623860</em>.</p>

<p>Thinking that I must have messed things up pretty badly, I decided to try the same procedure on the second HP ProLiant BL460c G8 blade installed in the same manner. And yet again, I got the same results.</p>

<p>While this is somewhat comforting when contemplating Albert Einstein´s <a href="http://www.brainyquote.com/quotes/quotes/a/alberteins133991.html">definition of insanity</a>, it´s not comforting when it comes to the procedure I followed for updating the hosts.</p>

<p>This time around I recorded the output the <em>esxcli</em> command gave me, and found this little gem hidden inside the output:(unrelated VIBs removed)</p>

<p>[cc lang=&laquo;bash&raquo; width=&laquo;95%&raquo; theme=&laquo;blackboard&raquo; nowrap=&laquo;0&raquo;]
~ # esxcli software vib install -d /vmfs/volumes/esx5local/ESXi500-201209001.zip
Installation Result
Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.
Reboot Required: true
VIBs Installed: [&hellip;], VMware_bootbank_scsi-hpsa_5.0.0-17vmw.500.0.0.469512, [&hellip;]
VIBs Removed: [&hellip;], Hewlett-Packard_bootbank_scsi-hpsa_5.0.0-28OEM.500.0.0.472560, [&hellip;]
~ #
[/cc]</p>

<p>So, in short the update from VMware removes the HP Bootbank VIB for local SCSI controllers, and replaces it with a VMware one. Effectively this removes the ESXi hosts ability to read the local datastore from the <strong>HP Smart Array P220i Controller</strong>.</p>

<p><strong>What still baffles me though, is that the first boot after applying the update boots <em>Build 821926</em>, but subsequent boots are on <em>Build 623860</em>&hellip;</strong></p>

<p>In the end, to rectify the issue, I found the <a href="http://h20565.www2.hp.com/portal/site/hpsc/template.PAGE/public/psi/swdDetails/?sp4ts.oid=5177950&amp;spf_p.tpst=swdMain&amp;spf_p.prp_swdMain=wsrp-navigationalState%3Didx%253D%257CswItem%253DMTX_c169c54cc80d4c1c8515b79d21%257CswEnvOID%253D4115%257CitemLocale%253D%257CswLang%253D%257Cmode%253D%257Caction%253DdriverDocument&amp;javax.portlet.begCacheTok=com.vignette.cachetoken&amp;javax.portlet.endCacheTok=com.vignette.cachetoken">scsi-hpsa-5.0.0-28OEM.500.0.0.472560.x86_64.vib</a> file on hp.com, downloaded it and placed it on the host.</p>

<p>I then ran the update again
[cc lang=&laquo;bash&raquo; width=&laquo;95%&raquo; theme=&laquo;blackboard&raquo; nowrap=&laquo;0&raquo;]
~ # esxcli software vib install -d /vmfs/volumes/datastore1/ESXi500-201209001.zip
Installation Result
Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.
Reboot Required: true
VIBs Installed: [&hellip;]
~ #
[/cc]</p>

<p>After installing the update, I then installed the <strong>HP ProLiant Smart Array Controller Driver</strong>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~ <span style="color:#75715e"># esxcli software vib install -v file:/tmp/scsi-hpsa-5.0.0-28OEM.500.0.0.472560.x86_64.vib
</span><span style="color:#75715e"></span>Installation Result
Message: The update completed successfully, but the system needs to be rebooted <span style="color:#66d9ef">for</span> the changes to be effective.
Reboot Required: true
VIBs Installed: Hewlett-Packard_bootbank_scsi-hpsa_5.0.0-28OEM.500.0.0.472560
VIBs Removed: VMware_bootbank_scsi-hpsa_5.0.0-17vmw.500.0.0.469512
VIBs Skipped:
~ #</code></pre></div></p>

<p>This reverses the removal of the _Hewlett-Packard_bootbank_scsi-hpsa<em>5.0.0-28OEM.500.0.0.472560</em> VIB by the VMware Update itself.</p>

<p>Another (quick) reboot, and finally my host was upgraded to the correct build and the local datastore was available too.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~ <span style="color:#75715e"># cat /proc/driver/hpsa/hpsa0
</span><span style="color:#75715e"></span>hpsa0: HP Smart Array P220i Controller
Board ID: 0x3355103c
Firmware Version: <span style="color:#ae81ff">3</span>.04
Driver Version: HP HPSA Driver <span style="color:#f92672">(</span>v <span style="color:#ae81ff">5</span>.0.0-28OEM<span style="color:#f92672">)</span>
Driver Build: <span style="color:#ae81ff">2</span>
IRQ: <span style="color:#ae81ff">217</span>
Logical drives: <span style="color:#ae81ff">1</span>
Current Q depth: <span style="color:#ae81ff">0</span>
Current <span style="color:#75715e"># commands on controller: 0
</span><span style="color:#75715e"></span>Max Q depth since init: <span style="color:#ae81ff">0</span>
Max <span style="color:#75715e"># commands on controller since init: 4
</span><span style="color:#75715e"></span>Max SG entries since init: <span style="color:#ae81ff">129</span>
Max Commands supported: <span style="color:#ae81ff">1020</span>
SCSI host number: <span style="color:#ae81ff">0</span>

hpsa0/C0:B0:T0:L1 Direct-Access LOGICAL VOLUME <span style="color:#ae81ff">3</span>.04 RAID <span style="color:#ae81ff">1</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span>+0<span style="color:#f92672">)</span>
~ #</code></pre></div>

<p>Thankfully these blades had not yet been put into production, and I was free to wrestle with them as much as I wanted to make this work, without it affecting anything other than my troubleshooting genes.</p>

<p>I have not tested if the same scenario unfolds if the hosts are updated via VMware Update Manager, but I suspect that the results would have been the same.</p>

<p>Of course, the hosts could have been installed with the newer <a href="https://my.vmware.com/web/vmware/details?downloadGroup=HP-ESXI-5.0.0-U1-15MAR2012_V2&amp;productId=229">HP ESXi 5.0 U1 Sept 2012 refresh</a> in the first place, and I probably would not have run into this issue, at least not until someone decided to apply a later patch to the host.</p>

<p>All in all, I guess the lesson here is that you need to be careful when updating your hosts and make sure you have a real retreat option ready if you need to quickly roll back to the previous build. The luxury of having the time and possibility to really troubleshoot the issue, might not be available to you if you are upgrading production systems.</p>

<p><em>Test your updates, every time.</em></p>

</div>


      <footer>
  


  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://vninja.net/vmware-2/access-vmworld-2012-sessions/" title="Want Access to the VMworld 2012 Sessions?">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
      <li class="next">
        <a href="https://vninja.net/vmware-2/vip-vcp-club-2012/" title="VIP VCP Club 2012">
            Next <span aria-hidden="true">&rarr;</span>
        </a>
      </li>
    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  

</div>

</footer>

    </div>
    
      <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
        <div>
  

    <div class="section">
      <h4>Sponsors</h4>
      <div class="ads" id="veeam">
        <ins class='dcmads' style='display:inline-block;width:250px;height:250px' data-dcm-placement='N410401.1772869VNINJA.NET/B10464038.145283149' data-dcm-rendering-mode='iframe' data-dcm-https-only data-dcm-resettable-device-id='' data-dcm-app-id=''> <script src='https://www.googletagservices.com/dcm/dcmads.js'></script> </ins>
      </div>
      <div class="ads" id="turbonomic">
        <a href="http://turbonomic.com/resources/hybrid-cloud-intelligent-bursting-aws-microsoft-azure/?utm_source=vninja&amp;utm_medium=banner-ad&amp;utm_campaign=wp-path-to-hybrid-cloud&amp;">
          <img width="250" height="250" src="https://vninja.net/ads/wp-intelligent-bursting-aws-azure-250x250.png"></a>
      </div>
      <div class="ads" id="goliath">
        <a href="http://goliathtechnologies.com/performance-monitoring/application-desktop-virtualization/vmware-horizon-view-monitoring/?utm_source=VNINJA&#038;utm_medium=PARTNER-MKTG&#038;utm_campaign=PARTNER-MKTG-VNINJA"><img width="250" height="250" src='https://vninja.net/ads/VMwareHorizon.jpg' alt='' title='VMwareHorizon' /></a>
      </div>
      <div class="ads" id="vembu">
        <a href="https://www.vembu.com/free-vm-backup/?utm_source=vninja.net&#038;utm_medium=Banner"><img width="250" height="250" src='https://vninja.net/ads/vembu250-250.gif'/></a>
      </div>


    </div>

    <hr>
    
      
      
      <div class="section">


      </div>
      
    
      
      
      <div class="section">


      </div>
      
    

</div>

      </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

<a href="https://vninja.net/disclaimer/">Disclaimer</a> <i>&middot;</i>

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
  Built with Hugo and lots of <i class='fa fa-coffee'></i>

</small>
</div>


    
<div class="container copyright">
    <small>
  &copy; 2018 Christian Mohn

  </small>
</div>




        </div>
    </div>
  </div>
</footer>

    

<script src="https://vninja.net/js/jquery.min.js"></script>
<script src="https://vninja.net/js/bootstrap.min.js"></script>


<script src="https://vninja.net/js/highlight.pack.js"></script>
<script src="https://vninja.net/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-121910549-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>
var ENABLE_POPOVER = "", 
EXPIRE_COOKIE = "", 
SHOW_MODAL_TIMEOUT = "", 
MOUSE_LEAVE = "", 
MODAL_SIZE = "", 
POST_URL = "", 
SIGNUP_HEADER = "",
HEADER_IMAGE = "",
IMG_DESCRIPTION = "",
SIGNUP_TEXT = "",
INPUT_PLACEHOLDER = "",
SUBMIT_BUTTON = "",
SUCCESS_MESSAGE = "",
ERROR_MESSAGE = "",
OPTIN = "",
COOKIE_NAME = "",
CONTENTLANGUAGE = ""; 
</script>










  </body>
</html>

