<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>ESXi5.5 to 6.0 Upgrade From Local HTTP Daemon  &middot; Adventures in Hugo</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="There is a thin line between agile and fragile" />

<meta name="keywords" content="ESXi, vCenter, VMware, vSphere, ">


<meta property="og:title" content="ESXi5.5 to 6.0 Upgrade From Local HTTP Daemon  &middot; Adventures in Hugo ">
<meta property="og:site_name" content="Adventures in Hugo"/>
<meta property="og:url" content="/vmware-2/esxi5-5-to-6-0-upgrade-from-local-http-daemon/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2015-08-26T11:35:08Z" />
<meta property="og:article:modified_time" content="2015-08-26T11:35:08Z" />

  
    
<meta property="og:article:tag" content="ESXi">
    
<meta property="og:article:tag" content="vCenter">
    
<meta property="og:article:tag" content="VMware">
    
<meta property="og:article:tag" content="vSphere">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="ESXi5.5 to 6.0 Upgrade From Local HTTP Daemon" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="/vmware-2/esxi5-5-to-6-0-upgrade-from-local-http-daemon/" />
<meta name="twitter:domain" content="/">
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "ESXi5.5 to 6.0 Upgrade From Local HTTP Daemon",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2015-08-26",
    "description": "",
    "wordCount": 563
  }
</script>
  



<link rel="canonical" href="/vmware-2/esxi5-5-to-6-0-upgrade-from-local-http-daemon/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
<link rel="icon" href="/favicon.png">
<meta name="generator" content="Hugo 0.40.3" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="/css/bootswatch/default/bootstrap.min.css">


<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">




  <link rel="stylesheet" href="/css/highlight/default.css">


</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
          
          <a class="navbar-brand-img" href="/">
            <img alt="" src="">
            
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>





<div class="container">
  <div class="row">
    <div class="col-sm-12">


      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" >
<header class="container hat">
  <h1>ESXi5.5 to 6.0 Upgrade From Local HTTP Daemon
</h1>

</header>
</div>


      <div class="content">
  

<p>I was recently involved with consulting for a Norwegian shipping company who has quite a few remote vSphere installations, most of them with a couple of ESXi hosts, but no vCenter and hence no Update Manager. While looking at methods for managing these installations, in particular how to facilitate patching and upgrading scenarios, I remembered that way back in 2013, I posted <a href="http://vninja.net/virtualization/quick-and-dirty-http-based-deployment/">Quick and Dirty HTTP-based Deployment</a> which shows how to use the Python to run a simple http daemon, and serve files from it.</p>

<p>Surely something similar can be used to maintain a central repository for vSphere patches? While I don&rsquo;t recommend using your MacBook as a permanent source for these updates, you really should set up a proper http server in your network and utilize that, it works as a proof of concept.</p>

<h5 id="so-here-it-is-a-recipe-for-using-a-simple-http-daemon-to-host-your-own-esxi-offline-bundles-and-how-to-upgrade-from-5-5-to-6-0-from-the-command-line">So here it is, a recipe for using a simple http daemon to host your own ESXi Offline Bundles, and how to upgrade from 5.5 to 6.0 from the command line.</h5>

<pre><code>1. Download the offline bundle you want to use, in my case I used _ESXi600-201507001.zip_ (ESXi 6.0.0b).


2. Extract the .zip file into it's own directory, served by the http daemon, and rename it for simplicity.


3. Connect to your target ESXi host via SSH


4. Check the current running ESXi version by running _esxcli system version get
</code></pre>

<p>_[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]
The time and date of this login have been sent to the system logs.VMware offers supported, powerful system administration tools. Please
see www.vmware.com/go/sysadmintools for details.The ESXi Shell can be disabled by an administrative user. See the
vSphere Security documentation for more information.
~ # esxcli system version get
Product: VMware ESXi
Version: 5.5.0
Build: Releasebuild-1623387
Update: 1
~ #[/cc]</p>

<pre><code>5. Enable outgoing http requests from the ESXi host by running _esxcli network firewall ruleset set -e true -r httpClient_


6. Determine which profile to use by running __esxcli software sources profile list -d [http://daemon-ip:port/directory/]
</code></pre>

<p>[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]
~ # esxcli software sources profile list -d <a href="http://172.29.100.248:8000/6.0/">http://172.29.100.248:8000/6.0/</a>
Name Vendor Acceptance Level</p>

<hr />

<p>ESXi-6.0.0-20150701001s-standard VMware, Inc. PartnerSupported
ESXi-6.0.0-20150701001s-no-tools VMware, Inc. PartnerSupported
ESXi-6.0.0-20150704001-no-tools VMware, Inc. PartnerSupported
ESXi-6.0.0-20150704001-standard VMware, Inc. PartnerSupported
~ #[/cc]__</p>

<pre><code>7. Run _vim-cmd hostsvc/maintenance_mode_enter_ to put ESXi host into maintenance mode.


8.  Run _esxcli software profile update -d [http://daemon-ip:port/directory/] -p [profilename] _to fetch and install from http daemon[cc lang=&quot;bash&quot; width=&quot;100%&quot; theme=&quot;blackboard&quot; nowrap=&quot;0&quot;]
</code></pre>

<h1 id="esxcli-software-profile-update-d-http-172-29-100-248-8000-6-0-p-esxi-6-0-0-20150704001-standard">esxcli software profile update -d <a href="http://172.29.100.248:8000/6.0/">http://172.29.100.248:8000/6.0/</a> -p ESXi-6.0.0-20150704001-standard</h1>

<p>Update Result
Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.
Reboot Required: true
VIBs Installed: [long list of vibs removed for brevity]
VIBs Skipped:
~ #[/cc]</p>

<pre><code>9. Disable outgoing http client traffic by running _esxcli network firewall ruleset set -e false httpClient_


10. Reboot host by running the _reboot_ command


11. When host has rebooted, connect to ESXi host again via SSH and run _esxcli system version get
</code></pre>

<p>[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;][root@localhost:~] esxcli system version get
Product: VMware ESXi
Version: 6.0.0
Build: Releasebuild-2809209
Update: 0
Patch: 11
[root@localhost:~][/cc]
_</p>

<pre><code>12. Verify that it runs the correct version, and run _vim-cmd hostsvc/maintenance_mode_exit_ to put the host out of maintenance mode.
</code></pre>

<p>And that&rsquo;s it, the host has now been upgraded from ESXi 5.5 to 6.0, from a local centralized http-based repository without the need to connect to the outside world. All done via the command line, and without a vCenter with Update Manager. Pretty neat.</p>

</div>


      
    </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
</small>
</div>


    
<div class="container copyright">
    <small>
  &copy; Christian Mohn

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="//s3.amazonaws.com/mailmunch/static/site.js" id="mailmunch-script" data-mailmunch-site-id="" async="async"></script>



<script src="//load.sumome.com/" data-sumo-site-id="" async="async"></script>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


<script src="/js/highlight.pack.js"></script>
<script src="/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
var ENABLE_POPOVER = "", 
EXPIRE_COOKIE = "", 
SHOW_MODAL_TIMEOUT = "", 
MOUSE_LEAVE = "", 
MODAL_SIZE = "", 
POST_URL = "", 
SIGNUP_HEADER = "",
HEADER_IMAGE = "",
IMG_DESCRIPTION = "",
SIGNUP_TEXT = "",
INPUT_PLACEHOLDER = "",
SUBMIT_BUTTON = "",
SUCCESS_MESSAGE = "",
ERROR_MESSAGE = "",
OPTIN = "",
COOKIE_NAME = "",
CONTENTLANGUAGE = ""; 
</script>





<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

