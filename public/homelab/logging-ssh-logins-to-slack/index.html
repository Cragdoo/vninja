<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Logging SSH logins to Slack" />
<meta property="og:description" content="I&rsquo;m using Slack to alert and log a few things in my environment, and one of the things I use it for is to alert me if someone logs on via SSH to my public facing Jumphost.
For a good walkthrough on how to set up such a host, check out Tunnel all your remote connections through ssh with a linux jumpbox by Luca Dell&rsquo;Oca.
My Ubuntu 16.04 Jumphost is set up to only accept Key-Based Authentication, to secure it as much as possible, but I would still like to get instant notification if someone logs into it interactively." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/homelab/logging-ssh-logins-to-slack/" />



<meta property="article:published_time" content="2016-10-06T11:31:51&#43;00:00"/>

<meta property="article:modified_time" content="2016-10-06T11:31:51&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Logging SSH logins to Slack"/>
<meta name="twitter:description" content="I&rsquo;m using Slack to alert and log a few things in my environment, and one of the things I use it for is to alert me if someone logs on via SSH to my public facing Jumphost.
For a good walkthrough on how to set up such a host, check out Tunnel all your remote connections through ssh with a linux jumpbox by Luca Dell&rsquo;Oca.
My Ubuntu 16.04 Jumphost is set up to only accept Key-Based Authentication, to secure it as much as possible, but I would still like to get instant notification if someone logs into it interactively."/>
<meta name="generator" content="Hugo 0.40.3" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Logging SSH logins to Slack",
  "url": "/homelab/logging-ssh-logins-to-slack/",
  "wordCount": "551",
  "datePublished": "2016-10-06T11:31:51&#43;00:00",
  "dateModified": "2016-10-06T11:31:51&#43;00:00",
  "author": {
    "@type": "Person",
    "name": "cmohn"
  },
  "keywords": "Homelab, Awesome, HomeLabOps, Slack"
}
</script>



    <link rel="canonical" href="/homelab/logging-ssh-logins-to-slack/">

    <title>Logging SSH logins to Slack | Adventures in Hugo</title>

    <!-- combined, minified CSS -->
    <link href="/css/style.css" rel="stylesheet" integrity="sha384-TbfEhJn4HkgPUIZUhhHaAYsycYKHxSuIloCjZOiyCSpbVunRQxg5T5pxKVFwxilF" crossorigin="anonymous">

    

    

    

    

  </head>

  <body>

    
    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link " href="/">Home</a>
          
          <a class="nav-link" href="https://example.org" title="">Link 1</a>
          
        </nav>
      </div>
    </div>
    

    
    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title"><a href="/" rel="home">Adventures in Hugo</a></h1>
        <p class="lead blog-description">There is a thin line between agile and fragile</p>
      </div>
    </header>
    

    
    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="/homelab/logging-ssh-logins-to-slack/">Logging SSH logins to Slack</a></h2>
    <p class="blog-post-meta"><time datetime="2016-10-06T11:31:51Z">Thu Oct 06, 2016</time> by cmohn in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/categories/homelab" rel="category tag">Homelab</a>


<i class="fa fa-tag" aria-hidden="true"></i>&nbsp;<a href="/tags/awesome" rel="tag">Awesome</a>, <a href="/tags/homelab" rel="tag">Homelab</a>, <a href="/tags/homelabops" rel="tag">HomeLabOps</a>, <a href="/tags/slack" rel="tag">Slack</a>

</p>
  </header>
  

<p>I&rsquo;m using <a href="http://vninja.net/homelab/homelabops-via-slack/">Slack to alert and log </a>a few things in my environment, and one of the things I use it for is to alert me if someone logs on via SSH to my public facing Jumphost.</p>

<p><em>For a good walkthrough on how to set up such a host, check out <a href="http://www.virtualtothecore.com/en/tunnel-all-your-remote-connections-through-ssh-with-a-linux-jumpbox/">Tunnel all your remote connections through ssh with a linux jumpbox</a> by <a href="https://twitter.com/dellock6">Luca Dell&rsquo;Oca</a>.</em></p>

<p>My Ubuntu 16.04 Jumphost is set up to only accept Key-Based Authentication, to secure it as much as possible, but I would still like to get instant notification if someone logs into it interactively.</p>

<h2 id="how-to-set-up-ssh-login-notification-to-slack">How to set up SSH login notification to Slack.</h2>

<ol>
<li><p><img src="http://vninja.net/wordpress/wp-content/uploads/2016/10/Screenshot-2016-10-06-13.04.51-300x182.png" alt="screenshot-2016-10-06-13-04-51" />First of all, we need  an Incoming WebHook in Slack in order to receive the notifications.
You configure those from the <strong>Apps &amp; Integration </strong>menu item. This in turn opens up the Slack App Directory, find <strong>Build</strong> on the top right and then choose <strong>Make a Custom Integration</strong>.</p></li>

<li><p><img src="http://vninja.net/wordpress/wp-content/uploads/2016/10/Screenshot-2016-10-06-13.08.09-300x60.png" alt="screenshot-2016-10-06-13-08-09" />One your are in the <strong>Build a Custom Integration </strong>section, find (or search) <strong>Incoming WebHooks</strong> and select that.</p></li>

<li><p>Next up, define which Slack channel should be the integration point, and click on <strong>Add Incoming WebHooks</strong> integration.</p></li>

<li><p>Copy the Webhook URL presented on the next screen
<strong>Note:</strong> keep this one a secret, anyone with access to this URL will be able to post to your Slack channel.</p></li>

<li><p>On my Ubuntu 16.04 Linux jumphost I&rsquo;ve created a small bash script called <em>/etc/ssh/notify.sh</em>. This script utilizes <em>curl </em> and the WebHook URL to post information directly to Slack. The script looks like this:<strong>notify.sh</strong>
[cc lang=&ldquo;bash&rdquo; escaped=&ldquo;true&rdquo;]
#!/bin/sh
url=&ldquo;<a href="https://hooks.slack.com/services/*********&quot;">https://hooks.slack.com/services/*********&quot;</a>
channel=&ldquo;#messages&rdquo;
host=&rdquo;<code>hostname</code>&ldquo;
content=&rdquo;\&ldquo;attachments\&rdquo;: [ { \&ldquo;mrkdwn_in\&rdquo;: [\&ldquo;text\&ldquo;, \&ldquo;fallback\&ldquo;], \&ldquo;fallback\&rdquo;: \&ldquo;SSH login: $USER connected to `$host`\&ldquo;, \&ldquo;text\&rdquo;: \&ldquo;SSH login to `$host`\&ldquo;, \&ldquo;fields\&rdquo;: [ { \&ldquo;title\&rdquo;: \&ldquo;User\&ldquo;, \&ldquo;value\&rdquo;: \&ldquo;$USER\&ldquo;, \&ldquo;short\&rdquo;: true }, { \&ldquo;title\&rdquo;: \&ldquo;IP Address\&ldquo;, \&ldquo;value\&rdquo;: \&ldquo;$SSH_CLIENT\&ldquo;, \&ldquo;short\&rdquo;: true } ], \&ldquo;color\&rdquo;: \&ldquo;#F35A00\&rdquo; } ]&rdquo;
curl -s -X POST &ndash;data-urlencode &ldquo;payload={\&ldquo;channel\&rdquo;: \&ldquo;$channel\&ldquo;, \&ldquo;mrkdwn\&rdquo;: true, \&ldquo;username\&rdquo;: \&ldquo;ssh-bot\&ldquo;, $content, \&ldquo;icon_emoji\&rdquo;: \&rdquo;:computer:\&ldquo;}&rdquo; $url
/bin/bash
[/cc]Replace the  the WebHook URL with your own from step 4 and which channel to post to and you should be ready to go.  This script logs the username and the IP address the connection comes from, and then posts it to the Slack WebHook with the help of <em>curl</em>.<strong>Note:</strong> I&rsquo;ve chosen to include the WebHook name etc in the script itself, instead of via the WebHook definition on Slack, mostly since I don&rsquo;t want to create a WebHook for all hosts I want logging from. With this setup, I can just change the username part of the _curl _command. It already logs the hostname, so this is pretty much superficial, but hey, that&rsquo;s how I made it.</p></li>

<li><p><em>chmod +x /etc/ssh/notify.sh</em> to make it executable, and test it. If everything works as expected, you should see an immediate log entry in your chosen Slack channel.</p></li>

<li><p>On order to make this script runs every time someone logs into the Jumphost, I added a ForceCommand to the end of my_ /etc/ssh/sshd_config _file, like this:[cc lang=&ldquo;bash&rdquo; escaped=&ldquo;true&rdquo;]
ForceCommand /etc/ssh/notify.sh
[/cc]</p></li>
</ol>

<p>And that&rsquo;s it. A login via SSH on the Jumphost now looks like this in my Slack channel:</p>

<p><img src="http://vninja.net/wordpress/wp-content/uploads/2016/10/Screenshot-2016-10-06-13.26.10-1-1024x179.png" alt="screenshot-2016-10-06-13-26-10" /></p>

<p>How awesome is that? Of course, this just scratches the surface of what is possible with Slack&rsquo;s Incoming WebHooks, I&rsquo;m using a similar approach for logging new devices discovered in phpmyipam but that&rsquo;s for another post.</p>


  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=%2fhomelab%2flogging-ssh-logins-to-slack%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=%2fhomelab%2flogging-ssh-logins-to-slack%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fhomelab%2flogging-ssh-logins-to-slack%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=%2fhomelab%2flogging-ssh-logins-to-slack%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 ml-auto blog-sidebar">
  

  

  
  <section class="sidebar-module">
    <h4>Links</h4>
    <ol class="list-unstyled">
      
      <li><a href="https://example.com">Link 1</a></li>
      
      <li><a href="https://example.org">Link 2</a></li>
      
    </ol>
  </section>
  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->
    

    
    <footer class="blog-footer">
      <p>
      
      &copy; Christian Mohn
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>
    

  </body>

</html>
