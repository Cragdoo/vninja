<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Configuring VSAN on a Dell PowerEdge VRTX  &middot; Adventures in Hugo</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="There is a thin line between agile and fragile" />

<meta name="keywords" content="Dell, ESXi, Hardware, storage, VMware, VRTX, VSAN, ">


<meta property="og:title" content="Configuring VSAN on a Dell PowerEdge VRTX  &middot; Adventures in Hugo ">
<meta property="og:site_name" content="Adventures in Hugo"/>
<meta property="og:url" content="/virtualization/configuring-vsan-dell-poweredge-vrtx/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-02-19T12:30:08Z" />
<meta property="og:article:modified_time" content="2014-02-19T12:30:08Z" />

  
    
<meta property="og:article:tag" content="Dell">
    
<meta property="og:article:tag" content="ESXi">
    
<meta property="og:article:tag" content="Hardware">
    
<meta property="og:article:tag" content="storage">
    
<meta property="og:article:tag" content="VMware">
    
<meta property="og:article:tag" content="VRTX">
    
<meta property="og:article:tag" content="VSAN">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="Configuring VSAN on a Dell PowerEdge VRTX" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="/virtualization/configuring-vsan-dell-poweredge-vrtx/" />
<meta name="twitter:domain" content="/">
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Configuring VSAN on a Dell PowerEdge VRTX",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-02-19",
    "description": "",
    "wordCount": 585
  }
</script>
  



<link rel="canonical" href="/virtualization/configuring-vsan-dell-poweredge-vrtx/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
<link rel="icon" href="/favicon.png">
<meta name="generator" content="Hugo 0.40.3" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="/css/bootswatch/default/bootstrap.min.css">


<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">




  <link rel="stylesheet" href="/css/highlight/default.css">


</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
          
          <a class="navbar-brand-img" href="/">
            <img alt="" src="">
            
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>





<div class="container">
  <div class="row">
    <div class="col-sm-12">


      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" >
<header class="container hat">
  <h1>Configuring VSAN on a Dell PowerEdge VRTX
</h1>

</header>
</div>


      <div class="content">
  <p><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/OriginalJPG.jpeg" alt="OriginalJPG" /></p>

<p>The <a href="http://www.dell.com/us/business/p/poweredge-vrtx/pd">Dell PowerEdge VRTX shared infrastructure platform</a> is interesting, and I&rsquo;ve been lucky enough to be able to borrow one from Dell for testing purposes.</p>

<p>One of the things I wanted to test, was if it was possible to run <a href="http://www.vmware.com/products/virtual-san">VMware VSAN</a> on it, even if the Shared PERC8 RAID controller it comes with is not on the <a href="http://www.vmware.com/resources/compatibility/search.php">VMware VSAN HCL</a>, nor does it provide a method to do passthrough to present raw disks directly to the hosts.</p>

<p>My test setup consists of:</p>

<ul>
<li><p>1 Dell PowerEdge VRTX</p>

<ul>
<li><p>SPERC 8</p>

<ul>
<li>7 x 300GB 15k SAS drives




<br /></li>
</ul></li>

<li><p>2 x Dell PowerEdge M520 blades</p>

<ul>
<li><p>2 x 6 core Intel Xeon E5-2420 @ 1.90Ghz CPU</p></li>

<li><p>32 GB RAM</p></li>

<li><p>2 x 146GB 15 SAS drives</p></li>
</ul></li>
</ul></li>
</ul>

<p>Both M520 blades were installed with  with ESXi 5.5, which is not a supported configuration from Dell. Dell has only certified ESXi 5.1 for use on the VRTX, but 5.5 seems to work just fine, with one caveat: <strong>Drivers for the SPERC8 controller is not included in the Dell customized image for ESXi 5.5. To get access to the volumes presented by the controller,  the <a href="http://www.vmware.com/resources/compatibility/detail.php?deviceCategory=io&amp;productid=34775&amp;deviceCategory=io&amp;keyword=shared&amp;page=1&amp;display_interval=10&amp;sortColumn=Partner&amp;sortOrder=Asc">6.801.52.00 megaraid-sas driver</a> needs to be installed after ESXi 5.5. </strong></p>

<p>Once that is installed, the volumes will appear as storage devices on the host.</p>

<p>Sadly the SPERC8 controller does not support passthrough for disksin the PowerEdge VRTX chassis, something VSAN wants (For details check <a href="https://blogs.vmware.com/vsphere/2013/09/vsan-and-storage-controllers.html">VSAN and Storage Controllers</a>). For testing purposes though, there is a way around it.</p>

<p>By creating several RAID0 Virtual Volumes on the controller, each one with only one disk in it, and assigning these disks to dedicated hosts in the chassis it is possible to present the disks to ESXi in a manner that VSAN can work with:</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Manage-Virtual-Disks-2014-02-18-13-14-41-2014-02-18-13-14-43.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Manage-Virtual-Disks-2014-02-18-13-14-41-2014-02-18-13-14-43-1024x489.png" alt="Dell PowerEdge VRTX VSAN Virtual Disks" /></a></p>

<p>A total of six RAID0 volumes have been created, three for each host.</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Assign-Virtual-Disks-2014-02-18-13-15-45-2014-02-18-13-15-47.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Assign-Virtual-Disks-2014-02-18-13-15-45-2014-02-18-13-15-47-1024x489.png" alt="Dell PowerEdge VRTX Disk Assignment" /></a></p>

<p>Each host gets granted exclusive access to three disks, resulting in them being presented as storage devices in vCenter</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/RawDisksVRTX.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/RawDisksVRTX.png" alt="RawDisksVRTX" /></a></p>

<p>Since I don&rsquo;t have any SSD drives in the chassis, something that is a requirement of VSAN, I also had to fool ESXi into believing one of the drives was in fact SSD. This is done by changing the claim rule for the given device. Find the device ID in the vSphere Client, and run the following commands to mark it as an SSD:</p>

<p>(Check <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2013188">KB2013188 Enabling the SSD option on SSD based disks/LUNs that are not detected as SSD</a> by default for details.)</p>

<p>[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]
~ # esxcli storage nmp satp rule add &ndash;satp VMW_SATP_LOCAL &ndash;device naa.6b8ca3a0edc7a9001a961838899ee72a &ndash;option=enable_ssd
~ # esxcli storage core claiming reclaim -d naa.6b8ca3a0edc7a9001a961838899ee72a
[/cc]</p>

<p>Once that part is taken care of, the rest of the setup is done by following the VSAN setup guides found in the <a href="http://www.vsanbeta.com/">beta community</a>.</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/New-Document-Royal-TSX-2014-02-19-12-27-47-2014-02-19-12-27-50.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/New-Document-Royal-TSX-2014-02-19-12-27-47-2014-02-19-12-27-50.png" alt="VSAN Configured" /></a></p>

<p>Two Dell PowerEdge M520 nodes up and running, with VSAN, replicating between them inside a Dell PowerEdge VRTX chassis. Pretty nifty!</p>

<p><em>It is worth noting is that in this setup, the SPERC8 is a single point of failure, as it provides disk access to all of the nodes in the same cluster. This is not something you want to have in a production environment, but Dell does offer a second SPERC8 option for redundancy purposes in the PowerEdge VRTX.</em></p>

<p>I did not do any performance testing on this setup, mostly since I don&rsquo;t have SSD&rsquo;s available for it, nor does it make much sense to do that kind of testing on a total of 6 HDD spindles;
<strong>This is more a proof of concept setup than a production environment.</strong></p>

</div>


      
    </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
</small>
</div>


    
<div class="container copyright">
    <small>
  &copy; Christian Mohn

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="//s3.amazonaws.com/mailmunch/static/site.js" id="mailmunch-script" data-mailmunch-site-id="" async="async"></script>



<script src="//load.sumome.com/" data-sumo-site-id="" async="async"></script>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


<script src="/js/highlight.pack.js"></script>
<script src="/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
var ENABLE_POPOVER = "", 
EXPIRE_COOKIE = "", 
SHOW_MODAL_TIMEOUT = "", 
MOUSE_LEAVE = "", 
MODAL_SIZE = "", 
POST_URL = "", 
SIGNUP_HEADER = "",
HEADER_IMAGE = "",
IMG_DESCRIPTION = "",
SIGNUP_TEXT = "",
INPUT_PLACEHOLDER = "",
SUBMIT_BUTTON = "",
SUCCESS_MESSAGE = "",
ERROR_MESSAGE = "",
OPTIN = "",
COOKIE_NAME = "",
CONTENTLANGUAGE = ""; 
</script>





<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

