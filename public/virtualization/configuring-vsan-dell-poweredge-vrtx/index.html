<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Configuring VSAN on a Dell PowerEdge VRTX" />
<meta property="og:description" content="The Dell PowerEdge VRTX shared infrastructure platform is interesting, and I&rsquo;ve been lucky enough to be able to borrow one from Dell for testing purposes.
One of the things I wanted to test, was if it was possible to run VMware VSAN on it, even if the Shared PERC8 RAID controller it comes with is not on the VMware VSAN HCL, nor does it provide a method to do passthrough to present raw disks directly to the hosts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/virtualization/configuring-vsan-dell-poweredge-vrtx/" />



<meta property="article:published_time" content="2014-02-19T12:30:08&#43;00:00"/>

<meta property="article:modified_time" content="2014-02-19T12:30:08&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Configuring VSAN on a Dell PowerEdge VRTX"/>
<meta name="twitter:description" content="The Dell PowerEdge VRTX shared infrastructure platform is interesting, and I&rsquo;ve been lucky enough to be able to borrow one from Dell for testing purposes.
One of the things I wanted to test, was if it was possible to run VMware VSAN on it, even if the Shared PERC8 RAID controller it comes with is not on the VMware VSAN HCL, nor does it provide a method to do passthrough to present raw disks directly to the hosts."/>
<meta name="generator" content="Hugo 0.40.3" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Configuring VSAN on a Dell PowerEdge VRTX",
  "url": "/virtualization/configuring-vsan-dell-poweredge-vrtx/",
  "wordCount": "585",
  "datePublished": "2014-02-19T12:30:08&#43;00:00",
  "dateModified": "2014-02-19T12:30:08&#43;00:00",
  "author": {
    "@type": "Person",
    "name": "cmohn"
  },
  "keywords": "Virtualization, Dell, ESXi, Hardware, storage, VMware, VRTX, VSAN"
}
</script>



    <link rel="canonical" href="/virtualization/configuring-vsan-dell-poweredge-vrtx/">

    <title>Configuring VSAN on a Dell PowerEdge VRTX | Adventures in Hugo</title>

    <!-- combined, minified CSS -->
    <link href="/css/style.css" rel="stylesheet" integrity="sha384-NnQTHLV1boeEOT&#43;VkddkaZe9ipwgoxh1CLY2U3LM36/GQpTS/1l4lL/5LnWh02Wk" crossorigin="anonymous">

    

    

    

    

  </head>

  <body>

    
    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link " href="/">Home</a>
          
          <a class="nav-link" href="https://example.org" title="">Link 1</a>
          
        </nav>
      </div>
    </div>
    

    
    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title"><a href="/" rel="home">Adventures in Hugo</a></h1>
        <p class="lead blog-description">There is a thin line between agile and fragile</p>
      </div>
    </header>
    

    
    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="/virtualization/configuring-vsan-dell-poweredge-vrtx/">Configuring VSAN on a Dell PowerEdge VRTX</a></h2>
    <p class="blog-post-meta"><time datetime="2014-02-19T12:30:08Z">Wed Feb 19, 2014</time> by cmohn in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/categories/virtualization" rel="category tag">Virtualization</a>


<i class="fa fa-tag" aria-hidden="true"></i>&nbsp;<a href="/tags/dell" rel="tag">Dell</a>, <a href="/tags/esxi" rel="tag">ESXi</a>, <a href="/tags/hardware" rel="tag">Hardware</a>, <a href="/tags/storage" rel="tag">storage</a>, <a href="/tags/vmware" rel="tag">VMware</a>, <a href="/tags/vrtx" rel="tag">VRTX</a>, <a href="/tags/vsan" rel="tag">VSAN</a>

</p>
  </header>
  <p><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/OriginalJPG.jpeg" alt="OriginalJPG" /></p>

<p>The <a href="http://www.dell.com/us/business/p/poweredge-vrtx/pd">Dell PowerEdge VRTX shared infrastructure platform</a> is interesting, and I&rsquo;ve been lucky enough to be able to borrow one from Dell for testing purposes.</p>

<p>One of the things I wanted to test, was if it was possible to run <a href="http://www.vmware.com/products/virtual-san">VMware VSAN</a> on it, even if the Shared PERC8 RAID controller it comes with is not on the <a href="http://www.vmware.com/resources/compatibility/search.php">VMware VSAN HCL</a>, nor does it provide a method to do passthrough to present raw disks directly to the hosts.</p>

<p>My test setup consists of:</p>

<ul>
<li><p>1 Dell PowerEdge VRTX</p>

<ul>
<li><p>SPERC 8</p>

<ul>
<li>7 x 300GB 15k SAS drives




<br /></li>
</ul></li>

<li><p>2 x Dell PowerEdge M520 blades</p>

<ul>
<li><p>2 x 6 core Intel Xeon E5-2420 @ 1.90Ghz CPU</p></li>

<li><p>32 GB RAM</p></li>

<li><p>2 x 146GB 15 SAS drives</p></li>
</ul></li>
</ul></li>
</ul>

<p>Both M520 blades were installed with  with ESXi 5.5, which is not a supported configuration from Dell. Dell has only certified ESXi 5.1 for use on the VRTX, but 5.5 seems to work just fine, with one caveat: <strong>Drivers for the SPERC8 controller is not included in the Dell customized image for ESXi 5.5. To get access to the volumes presented by the controller,  the <a href="http://www.vmware.com/resources/compatibility/detail.php?deviceCategory=io&amp;productid=34775&amp;deviceCategory=io&amp;keyword=shared&amp;page=1&amp;display_interval=10&amp;sortColumn=Partner&amp;sortOrder=Asc">6.801.52.00 megaraid-sas driver</a> needs to be installed after ESXi 5.5. </strong></p>

<p>Once that is installed, the volumes will appear as storage devices on the host.</p>

<p>Sadly the SPERC8 controller does not support passthrough for disksin the PowerEdge VRTX chassis, something VSAN wants (For details check <a href="https://blogs.vmware.com/vsphere/2013/09/vsan-and-storage-controllers.html">VSAN and Storage Controllers</a>). For testing purposes though, there is a way around it.</p>

<p>By creating several RAID0 Virtual Volumes on the controller, each one with only one disk in it, and assigning these disks to dedicated hosts in the chassis it is possible to present the disks to ESXi in a manner that VSAN can work with:</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Manage-Virtual-Disks-2014-02-18-13-14-41-2014-02-18-13-14-43.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Manage-Virtual-Disks-2014-02-18-13-14-41-2014-02-18-13-14-43-1024x489.png" alt="Dell PowerEdge VRTX VSAN Virtual Disks" /></a></p>

<p>A total of six RAID0 volumes have been created, three for each host.</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Assign-Virtual-Disks-2014-02-18-13-15-45-2014-02-18-13-15-47.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/CMC-FLBNZY1-Assign-Virtual-Disks-2014-02-18-13-15-45-2014-02-18-13-15-47-1024x489.png" alt="Dell PowerEdge VRTX Disk Assignment" /></a></p>

<p>Each host gets granted exclusive access to three disks, resulting in them being presented as storage devices in vCenter</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/RawDisksVRTX.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/RawDisksVRTX.png" alt="RawDisksVRTX" /></a></p>

<p>Since I don&rsquo;t have any SSD drives in the chassis, something that is a requirement of VSAN, I also had to fool ESXi into believing one of the drives was in fact SSD. This is done by changing the claim rule for the given device. Find the device ID in the vSphere Client, and run the following commands to mark it as an SSD:</p>

<p>(Check <a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2013188">KB2013188 Enabling the SSD option on SSD based disks/LUNs that are not detected as SSD</a> by default for details.)</p>

<p>[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]
~ # esxcli storage nmp satp rule add &ndash;satp VMW_SATP_LOCAL &ndash;device naa.6b8ca3a0edc7a9001a961838899ee72a &ndash;option=enable_ssd
~ # esxcli storage core claiming reclaim -d naa.6b8ca3a0edc7a9001a961838899ee72a
[/cc]</p>

<p>Once that part is taken care of, the rest of the setup is done by following the VSAN setup guides found in the <a href="http://www.vsanbeta.com/">beta community</a>.</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/02/New-Document-Royal-TSX-2014-02-19-12-27-47-2014-02-19-12-27-50.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/02/New-Document-Royal-TSX-2014-02-19-12-27-47-2014-02-19-12-27-50.png" alt="VSAN Configured" /></a></p>

<p>Two Dell PowerEdge M520 nodes up and running, with VSAN, replicating between them inside a Dell PowerEdge VRTX chassis. Pretty nifty!</p>

<p><em>It is worth noting is that in this setup, the SPERC8 is a single point of failure, as it provides disk access to all of the nodes in the same cluster. This is not something you want to have in a production environment, but Dell does offer a second SPERC8 option for redundancy purposes in the PowerEdge VRTX.</em></p>

<p>I did not do any performance testing on this setup, mostly since I don&rsquo;t have SSD&rsquo;s available for it, nor does it make much sense to do that kind of testing on a total of 6 HDD spindles;
<strong>This is more a proof of concept setup than a production environment.</strong></p>


  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=%2fvirtualization%2fconfiguring-vsan-dell-poweredge-vrtx%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=%2fvirtualization%2fconfiguring-vsan-dell-poweredge-vrtx%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fvirtualization%2fconfiguring-vsan-dell-poweredge-vrtx%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=%2fvirtualization%2fconfiguring-vsan-dell-poweredge-vrtx%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 ml-auto blog-sidebar">
  

  

  
  <section class="sidebar-module">
    <h4>Links</h4>
    <ol class="list-unstyled">
      
      <li><a href="https://example.com">Link 1</a></li>
      
      <li><a href="https://example.org">Link 2</a></li>
      
    </ol>
  </section>
  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->
    

    
    <footer class="blog-footer">
      <p>
      
      &copy; Christian Mohn
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>
    

  </body>

</html>
