<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Fixing &#34;Could not create vFlash cache&#34; error when powering on a VM  &middot; Adventures in Hugo</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="There is a thin line between agile and fragile" />

<meta name="keywords" content="featured, SSD, vCenter, vCenter Appliance, VCSA, vFlash Read Cache, vFRC, vSphere, Web Client, ">


<meta property="og:title" content="Fixing &#34;Could not create vFlash cache&#34; error when powering on a VM  &middot; Adventures in Hugo ">
<meta property="og:site_name" content="Adventures in Hugo"/>
<meta property="og:url" content="/virtualization/fixing-could-create-vflash-cache-error-powering-vm/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-01-19T19:19:02Z" />
<meta property="og:article:modified_time" content="2014-01-19T19:19:02Z" />

  
    
<meta property="og:article:tag" content="featured">
    
<meta property="og:article:tag" content="SSD">
    
<meta property="og:article:tag" content="vCenter">
    
<meta property="og:article:tag" content="vCenter Appliance">
    
<meta property="og:article:tag" content="VCSA">
    
<meta property="og:article:tag" content="vFlash Read Cache">
    
<meta property="og:article:tag" content="vFRC">
    
<meta property="og:article:tag" content="vSphere">
    
<meta property="og:article:tag" content="Web Client">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@" />
<meta name="twitter:title" content="Fixing &#34;Could not create vFlash cache&#34; error when powering on a VM" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="/virtualization/fixing-could-create-vflash-cache-error-powering-vm/" />
<meta name="twitter:domain" content="/">
  

  
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Fixing &#34;Could not create vFlash cache&#34; error when powering on a VM",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-01-19",
    "description": "",
    "wordCount": 736
  }
</script>
  



<link rel="canonical" href="/virtualization/fixing-could-create-vflash-cache-error-powering-vm/" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
<link rel="icon" href="/favicon.png">
<meta name="generator" content="Hugo 0.40.3" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.2/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="/css/bootswatch/default/bootstrap.min.css">


<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css">




  <link rel="stylesheet" href="/css/highlight/default.css">


</head>
<body data-ng-app="myapp" data-ng-controller="MyController" data-ng-mouseleave="MouseLeave($event)">
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        
          
          <a class="navbar-brand-img" href="/">
            <img alt="" src="">
            
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            
            
            
              
          </ul>
        </div>
        
      </div>
    </nav>
  </header>





<div class="container">
  <div class="row">
    <div class="col-sm-12">


      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" >
<header class="container hat">
  <h1>Fixing &#34;Could not create vFlash cache&#34; error when powering on a VM
</h1>

</header>
</div>


      <div class="content">
  <p>During some way overdue housekeeping in my HP Microserver-based &ldquo;Homelab&rdquo; today, I ran into a rather annoying issue that prevented me from starting one of my more important VMs; namely my home Domain Controller.</p>

<p>In short, I removed an old SSD drive that I&rsquo;ve used for vFlash Read Cache (vFRC) testing and installed a new 1TB drive instead. Since I have a rather beefy work lab now, I need space more than speed at home, so this seemed like a good idea at the time.</p>

<p>A good idea that is, until I tried starting my DC VM, which also is my DNS and DHCP server, and got greeted with this little gem:</p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2014/01/Zappa-SSD-Failure.png"><img src="http://vninja.net/wordpress/wp-content/uploads/2014/01/Zappa-SSD-Failure.png" alt="Zappa-SSD-Failure" /></a></p>

<p>The &ldquo;_Could not create vFlash cache: msg.vflashcache.error.VFC<em>FAILURE</em>&rdquo; error is understandable, the SSD drive was removed, but I honestly did not think that even if a VM was configured to use it, that it&rsquo;s absence would prevent a power-on operation on that VM. I would have expected it to throw a warning about the cache location missing, and warn me that acceleration was not happening, not a flat out &ldquo;<em>cannot power on</em>&rdquo;.</p>

<p>Normally the fix for this would be quick and easy, edit the VM and remove the <strong>vFRC</strong> configuration, but since my host has a whopping total of 8GB of memory I don&rsquo;t have vCenter running at all times.  Editing the VM settings through the vCenter Legacy Client (C#) does not work, since vFRC requires Virtual Hardware Version 10, which it cannot edit.</p>

<p>Once I got the vCenter Server Appliance (vCSA) fired up, I realised that I have somehow forgotten the admin AND root passwords, and was completely unable to log-on. How that has happened is beyond me, but for the life of me I was not able to log on.</p>

<p>Next step was to try and edit the VM from VMware Workstation 10 installed on one of the Windows boxes in my network. Sadly Workstation has no concept of <strong>vFRC</strong>, and it is not possible to edit that particular VM setting, even if you connect it to the vSphere host. I later on also realized that VMware Workstation 10 is also unable to host connect  USB peripherals, like printers, to a VM, but that&rsquo;s beside the point right now.<a href="https://www.google.com/search?client=safari&amp;rls=en&amp;q=peripherals&amp;spell=1&amp;sa=X&amp;ei=PCHcUtu7KoeS5ASH1IGoDw&amp;ved=0CCcQvwUoAA"><strong>_
_</strong></a></p>

<p>So, either trying to hack the VM Hardware Version to a value that the vSphere Client can handle, of  deploying a new <strong>vCSA</strong> instance, I was left with editing the VMs <em>vmx</em> file directly.</p>

<p>Thankfully this was an easy way to fix the problem, and get the VM powered on. For each vmdk file that is configured to use <strong>vFRC</strong>, there is a corresponding entry in the <em>vmx</em> file, that controls <strong>vFRC</strong>.</p>

<p>In order to turn off <strong>vFRC</strong> acceleration for a given disk, download the vmx file, and change the value for <device>.vFlash.enabled from
[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]
sched.scsi0:2.vFlash.enabled = &ldquo;TRUE&rdquo;
[/cc]
to
[cc lang=&ldquo;bash&rdquo; width=&ldquo;100%&rdquo; theme=&ldquo;blackboard&rdquo; nowrap=&ldquo;0&rdquo;]
sched.scsi0:2.vFlash.enabled = &ldquo;FALSE&rdquo;
[/cc]</p>

<p>Re-upload the <em>vmx</em> file, and try to power on. In my case, this fixed the problem of powering on the VM.</p>

<p>This problem again highlights one of the problems with the dependancy on the new vSphere Web Client. In a real production environment, the vCenter would be up and running at all times, and editing the VM would have been a small task, but what if you had used <strong>vFRC</strong> to speed up <strong>vCSA</strong> itself, and you had a failed SSD drive?</p>

<p>Of course, in this case the fault is mostly mine. I removed a &ldquo;production SSD&rdquo;, without first removing the <strong>vFRC</strong> configuration. I did not have a working vCSA with Web Client up and running when this was done, and I had forgotten my passwords. A pretty specific error generating procedure if there ever was one.</p>

<p>It&rsquo;s an easy fix to edit the <em>vmx</em> file, but it does at times feel a little bit like you are now able to cut of the branch you are sitting on with the new vSphere Web Client. In simpler days, you could pretty much fix anything by connecting the vSphere Client to the host and fix any errors there, but now the dependancy on the vCenter Server is stronger than ever.</p>

<p>_ Before upgrading your VMs to Hardware Version 10, make sure you understand the implications of going all-in with dependancies on the Web Client and vCenter. It might just come back and bite you if you _<em>haven&rsquo;t thought through your design.</em></p>

</div>


      
    </div>
    
  </div>
</div>
    
<footer class="footer hidden-print">
  <div class="container">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="javascript:" id="return-to-top">back to top</a>
</div>
<div class="pull-right">

</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
              
    
<div class="container footline">
    <small>
</small>
</div>


    
<div class="container copyright">
    <small>
  &copy; Christian Mohn

  </small>
</div>



        </div>
    </div>
  </div>
</footer>

    

<script src="//s3.amazonaws.com/mailmunch/static/site.js" id="mailmunch-script" data-mailmunch-site-id="" async="async"></script>



<script src="//load.sumome.com/" data-sumo-site-id="" async="async"></script>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


<script src="/js/highlight.pack.js"></script>
<script src="/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
var ENABLE_POPOVER = "", 
EXPIRE_COOKIE = "", 
SHOW_MODAL_TIMEOUT = "", 
MOUSE_LEAVE = "", 
MODAL_SIZE = "", 
POST_URL = "", 
SIGNUP_HEADER = "",
HEADER_IMAGE = "",
IMG_DESCRIPTION = "",
SIGNUP_TEXT = "",
INPUT_PLACEHOLDER = "",
SUBMIT_BUTTON = "",
SUCCESS_MESSAGE = "",
ERROR_MESSAGE = "",
OPTIN = "",
COOKIE_NAME = "",
CONTENTLANGUAGE = ""; 
</script>





<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//MathJax.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax//config/TeX-AMS-MML_HTMLorMML.js"></script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    for(var all in MathJax.Hub.getAllJax()) {
        all.SourceElement().parentNode.className += ' has-jax';

    }
});
</script>






  </body>
</html>

