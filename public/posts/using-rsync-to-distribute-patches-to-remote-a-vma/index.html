<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Using rsync to Distribute Patches to a Remote vMA " />
<meta property="og:description" content="I recently posted Using vMA as a local vSphere Patch Repository, where I outlined how you can use your vMA instances as local file repositories for updates.
This post is a continuation of that concept, but this time I&rsquo;ll take it a step further and utilize rsync to make sure my vMA instances all contain the same set of patches. Rsync is great for this, as it handles fast incremental file transfers, which is a real time and bandwidth saver in my particular scenario." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/using-rsync-to-distribute-patches-to-remote-a-vma/" />



<meta property="article:published_time" content="2011-03-08T08:00:02&#43;00:00"/>

<meta property="article:modified_time" content="2011-03-08T08:00:02&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Using rsync to Distribute Patches to a Remote vMA "/>
<meta name="twitter:description" content="I recently posted Using vMA as a local vSphere Patch Repository, where I outlined how you can use your vMA instances as local file repositories for updates.
This post is a continuation of that concept, but this time I&rsquo;ll take it a step further and utilize rsync to make sure my vMA instances all contain the same set of patches. Rsync is great for this, as it handles fast incremental file transfers, which is a real time and bandwidth saver in my particular scenario."/>
<meta name="generator" content="Hugo 0.40.3" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Using rsync to Distribute Patches to a Remote vMA ",
  "url": "/posts/using-rsync-to-distribute-patches-to-remote-a-vma/",
  "wordCount": "841",
  "datePublished": "2011-03-08T08:00:02&#43;00:00",
  "dateModified": "2011-03-08T08:00:02&#43;00:00",
  "author": {
    "@type": "Person",
    "name": "cmohn"
  },
  "keywords": "Howto, Virtualization, ESX, ESXi, Ops, rsync, vCLI, Virtual Appliance, vMA, VMware, vSphere"
}
</script>



    <link rel="canonical" href="/posts/using-rsync-to-distribute-patches-to-remote-a-vma/">

    <title>Using rsync to Distribute Patches to a Remote vMA | Adventures in Hugo</title>

    <!-- combined, minified CSS -->
    <link href="/css/style.css" rel="stylesheet" integrity="sha384-TbfEhJn4HkgPUIZUhhHaAYsycYKHxSuIloCjZOiyCSpbVunRQxg5T5pxKVFwxilF" crossorigin="anonymous">

    

    

    

    

  </head>

  <body>

    
    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link " href="/">Home</a>
          
          <a class="nav-link" href="https://example.org" title="">Link 1</a>
          
        </nav>
      </div>
    </div>
    

    
    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title"><a href="/" rel="home">Adventures in Hugo</a></h1>
        <p class="lead blog-description">There is a thin line between agile and fragile</p>
      </div>
    </header>
    

    
    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="/posts/using-rsync-to-distribute-patches-to-remote-a-vma/">Using rsync to Distribute Patches to a Remote vMA</a></h2>
    <p class="blog-post-meta"><time datetime="2011-03-08T08:00:02Z">Tue Mar 08, 2011</time> by cmohn in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/categories/howto" rel="category tag">Howto</a>, <a href="/categories/virtualization" rel="category tag">Virtualization</a>


<i class="fa fa-tag" aria-hidden="true"></i>&nbsp;<a href="/tags/esx" rel="tag">ESX</a>, <a href="/tags/esxi" rel="tag">ESXi</a>, <a href="/tags/ops" rel="tag">Ops</a>, <a href="/tags/rsync" rel="tag">rsync</a>, <a href="/tags/vcli" rel="tag">vCLI</a>, <a href="/tags/virtual-appliance" rel="tag">Virtual Appliance</a>, <a href="/tags/vma" rel="tag">vMA</a>, <a href="/tags/vmware" rel="tag">VMware</a>, <a href="/tags/vsphere" rel="tag">vSphere</a>

</p>
  </header>
  

<p>I recently posted <a href="http://vninja.net/virtualization/using-vma-as-a-local-vsphere-patch-repository/">Using vMA as a local vSphere Patch Repository</a>, where I outlined how you can use your vMA instances as local file repositories for updates.</p>

<p>This post is a continuation of that concept, but this time I&rsquo;ll take it a step further and utilize <a href="http://samba.anu.edu.au/rsync/">rsync</a>  to make sure my vMA instances all contain the same set of patches. Rsync is great for this, as it handles fast incremental file transfers, which is a real time and bandwidth saver in my particular scenario. So, the premise is that you have one central vMA instance, and one or more remote vMA instances that should pull updates from the centrally located one.</p>

<h3 id="installing-rsync-in-vma">Installing rsync in vMA</h3>

<p>Sadly, rsync isn&rsquo;t included in vMA by default. To get it installed, we need to edit some files inside of vMA. Since vMA is CentOS based, this means configuring <a href="http://www.centos.org/docs/5/html/yum/">yum</a> repositories, and thankfully the brilliant <a href="http://twitter.com/lamw">William Lam</a> over at <a href="http://www.virtuallyghetto.com">virtuallyGhetto</a> has already done the hard work for us. In his post named <a href="http://www.virtuallyghetto.com/2010/07/automate-update-manager-operations.html">Automate Update Manager Operations using vSphere SDK for Perl + VIX + PowerCLI + PowerCLI VUM</a> William explains which files to edit to create a valid repository configuration for installation of official packages directly from CentOS.</p>

<p><em>Warning: Do this on your own risk, I have not checked but I think this will fall under the &ldquo;unsupported&rdquo; tab at VMware</em>.</p>

<h4 id="configuring-yum-in-vma">Configuring YUM in vMA</h4>

<p>These instructions are pretty much copied from Williams post, but added here for context:</p>

<h5 id="creating-the-repository-configuration-file">Creating the repository configuration file</h5>

<p>To create the file, in the correct directory, run the followinf command:</p>

<pre><code>[vi-admin@vMA /]$ sudo vi /etc/yum.repos.d/centos-base.repo
Password:
</code></pre>

<p>Add the following lines to the repository file:</p>

<pre><code>[base]
name=CentOS-5 - Base
baseurl=http://mirror.centos.org/centos/5/os/x86_64/
gpgcheck=1
gpgkey=http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5

[update]
name=CentOS-5 - Updates
baseurl=http://mirror.centos.org/centos/5/updates/x86_64/
gpgcheck=1
gpgkey=http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-5
</code></pre>

<p>Exit the <strong>vi</strong> editor by hitting <em>esc</em> and entering <em>:wq</em> and hit enter. That saves the file, and exits the editor.</p>

<h5 id="installing-rsync-via-yum">Installing rsync via yum</h5>

<p>Now comes the easy part, actually installing rsync inside vMA. All you have to do, is to enter the following command:</p>

<pre><code>[vi-admin@vMA /]$ sudo yum -y install rsync
</code></pre>

<p>The installation starts, and you should see output similar to the following:</p>

<pre><code>Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
Setting up Install Process
Parsing package install arguments
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package rsync.x86_64 0:2.6.8-3.1 set to be updated
--&gt; Finished Dependency Resolution

Dependencies Resolved

====================================================================================
 Package           Arch               Version                Repository        Size
====================================================================================
Installing:
 rsync             x86_64             2.6.8-3.1              base             235 k

Transaction Summary
====================================================================================
Install      1 Package(s)
Update       0 Package(s)
Remove       0 Package(s)

Total download size: 235 k
Downloading Packages:
rsync-2.6.8-3.1.x86_64.rp 100% |=========================| 235 kB    00:01
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing     : rsync                                             [1/1]

Installed: rsync.x86_64 0:2.6.8-3.1
Complete!
[vi-admin@vMA /]$
</code></pre>

<p>And there it is, rsync installed inside vMA!</p>

<h3 id="configuring-rsync-to-fetch-upgrades-from-central-vma">Configuring rsync to fetch upgrades from central vMA</h3>

<p>Now that we have rsync installed inside vMA, we need to configure it to fetch the updates from a central vMA instance. Rsync needs to be installed in both ends of the pipe, so if you haven&rsquo;t already done so, configure your &ldquo;master vMA&rdquo; the same way as mentioned above.</p>

<p>Now that &ldquo;both ends&rdquo; of the pipe has rsync installed, we can run it from &ldquo;client vMA&rdquo; to pull down all the files currently in the repository on the &ldquo;master vMA&rdquo;.</p>

<pre><code>[vi-admin@vMA /]$sudo rsync -r vi-admin@192.168.5.57:/var/www/html/repo/* /var/www.html/repo
The authenticity of host '192.168.5.57 (192.168.5.57)' can't be established.
RSA key fingerprint is 3f:af:7c:53:5a:15:47:56:b8:25:77:79:14:b2:f5:2f.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.5.57' (RSA) to the list of known hosts.
vi-admin@192.168.5.57's password:
[vi-admin@vMA /]$
</code></pre>

<p>The command runs for a while, and when it finished you should see that the current contents of the &ldquo;master vMA&rdquo; repository is now located in the &ldquo;client vMA&rdquo; repository as well:</p>

<pre><code>[vi-admin@vMA repo]$ ls -la
total 210988
drwxr-xr-x 2 root root      4096 Mar  8 18:51 .
drwxr-xr-x 4 root root      4096 Mar  8 18:50 ..
-rw-r--r-- 1 root root         0 Mar  8 18:51 testfile
-rw-r--r-- 1 root root         0 Mar  8 18:51 testfile1
-rw-r--r-- 1 root root         0 Mar  8 18:51 testfile2
-rw-r--r-- 1 root root         0 Mar  8 18:51 testfile3
-rw-r--r-- 1 root root 215820281 Jan 27 19:15 update-from-esxi4.1-4.1_update01.zip
[vi-admin@vMA repo]$
</code></pre>

<h4 id="conclusion">Conclusion</h4>

<p>There is a lot more you can do with rsync, like replication files both ways, controlling bandwidth usage, using ssh keys to avoid username/password prompts, something that is required if you want to fully automated this process. I will not cover that, at least not right now, so head over to the <a href="http://samba.anu.edu.au/rsync/">rsync</a> site to read up on the documentation for more advanced use cases.</p>

<p>Even if I&rsquo;ve barely touched the features rsync provides, it is clear that this is a way for admins to centrally manage distribution of vSphere patches to remote locations, even if the bandwidth is low and the latency high. Rsync provides us with ways to overcome the patching issues that you might see in poorly networked environments, and it can certainly help vAdmins keeping their environments patched and current, and that has to be a good thing™</p>


  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=%2fposts%2fusing-rsync-to-distribute-patches-to-remote-a-vma%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=%2fposts%2fusing-rsync-to-distribute-patches-to-remote-a-vma%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fposts%2fusing-rsync-to-distribute-patches-to-remote-a-vma%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=%2fposts%2fusing-rsync-to-distribute-patches-to-remote-a-vma%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 ml-auto blog-sidebar">
  

  

  
  <section class="sidebar-module">
    <h4>Links</h4>
    <ol class="list-unstyled">
      
      <li><a href="https://example.com">Link 1</a></li>
      
      <li><a href="https://example.org">Link 2</a></li>
      
    </ol>
  </section>
  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->
    

    
    <footer class="blog-footer">
      <p>
      
      &copy; Christian Mohn
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>
    

  </body>

</html>
