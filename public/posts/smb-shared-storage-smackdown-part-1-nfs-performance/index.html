<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="SMB Shared Storage Smackdown - Part 1 NFS Performance" />
<meta property="og:description" content="Recently at the office I was given the task to test out some SMB NAS products to use as potential candidates for some of our small branch offices all over the world. I did many tests relating from backup and replication to actually running VMs on them and pounding them with IOmeter. What I will share with you in this series of posts is my vSphere/IOmeter tests for NFS and iSCSI." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/smb-shared-storage-smackdown-part-1-nfs-performance/" />



<meta property="article:published_time" content="2011-07-17T19:31:22&#43;00:00"/>

<meta property="article:modified_time" content="2011-07-17T19:31:22&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SMB Shared Storage Smackdown - Part 1 NFS Performance"/>
<meta name="twitter:description" content="Recently at the office I was given the task to test out some SMB NAS products to use as potential candidates for some of our small branch offices all over the world. I did many tests relating from backup and replication to actually running VMs on them and pounding them with IOmeter. What I will share with you in this series of posts is my vSphere/IOmeter tests for NFS and iSCSI."/>
<meta name="generator" content="Hugo 0.40.3" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "SMB Shared Storage Smackdown - Part 1 NFS Performance",
  "url": "/posts/smb-shared-storage-smackdown-part-1-nfs-performance/",
  "wordCount": "817",
  "datePublished": "2011-07-17T19:31:22&#43;00:00",
  "dateModified": "2011-07-17T19:31:22&#43;00:00",
  "author": {
    "@type": "Person",
    "name": "eczerwin"
  },
  "keywords": "Virtualization"
}
</script>



    <link rel="canonical" href="/posts/smb-shared-storage-smackdown-part-1-nfs-performance/">

    <title>SMB Shared Storage Smackdown - Part 1 NFS Performance | Adventures in Hugo</title>

    <!-- combined, minified CSS -->
    <link href="/css/style.css" rel="stylesheet" integrity="sha384-TbfEhJn4HkgPUIZUhhHaAYsycYKHxSuIloCjZOiyCSpbVunRQxg5T5pxKVFwxilF" crossorigin="anonymous">

    

    

    

    

  </head>

  <body>

    
    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link " href="/">Home</a>
          
          <a class="nav-link" href="https://example.org" title="">Link 1</a>
          
        </nav>
      </div>
    </div>
    

    
    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title"><a href="/" rel="home">Adventures in Hugo</a></h1>
        <p class="lead blog-description">There is a thin line between agile and fragile</p>
      </div>
    </header>
    

    
    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="/posts/smb-shared-storage-smackdown-part-1-nfs-performance/">SMB Shared Storage Smackdown - Part 1 NFS Performance</a></h2>
    <p class="blog-post-meta"><time datetime="2011-07-17T19:31:22Z">Sun Jul 17, 2011</time> by eczerwin in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/categories/virtualization" rel="category tag">Virtualization</a>


</p>
  </header>
  <p>Recently at the office I was given the task to test out some SMB NAS products to use as potential candidates for some of our small branch offices all over the world.  I did many tests relating from backup and replication to actually running VMs on them and pounding them with IOmeter.  What I will share with you in this series of  posts is my vSphere/IOmeter tests for NFS and iSCSI. With these tests my main goal was to see what kinds of IO loads the NAS devices could handle and also how suitable they would be for running a small vSphere environment.  In my next post I will go into iSCSI performance and will publish all of my results including NFS into a downloadable PDF.</p>

<p><strong>NAS Devices</strong></p>

<ul>
<li><p>Synology DS411+</p></li>

<li><p>NetGear ReadyNAS NV+</p></li>

<li><p>QNAP TS4139 Pro II+</p></li>

<li><p>Iomega StorCenter ix4-200d</p></li>
</ul>

<p>I chose all 4 drive models of the arrays and they are all filled with 1 TB SATA disks.  It was chosen this way since we would also be using these devices to hold rather large backups and replicate them elsewhere.</p>

<p>To start out with I upgraded all of them to the latest firmware and created RAID 5 arrays on each of them.  To make a long story short this gave me anywhere from 2.5 TB - 2.8 TB usable storage on each device.  Since I tested both NFS and iSCSI I first created a 1 TB iSCSI Lun (1MB block size on Datastore) on each device then created an NFS export for the remainder of the space.  Another small note is I was sure that write cacheing was enabled for all arrays that had an option to have to have turned on or off.  Then I got down to setting up vSphere and the rest of my hardware.</p>

<p><strong>Server/VM/Network Infrastructure</strong></p>

<ul>
<li><p>1 HP DL380 G5 - 2 quad core pCPUs - 16 logical cores with HT enabled 16GB of pRAM - ESXi 4.1 U1 installed default configuration</p></li>

<li><p>Win2k8 VMs on each NAS Device 24GB boot device VMDK 100GB VMDK with standard LSI logic SAS connector 1 vCPU and 4096 vRAM</p></li>

<li><p>DELL Powerconnect 5524 Switch - Split up into VLAN for VMs/vSphere Management and VLAN for iSCSI/NFS traffic</p></li>
</ul>

<p>I began the task of plugging everything in, getting everything set up properly as not to skew any results, and spinning up VMs in the Datastores from the attached iSCSI Luns/NFS Exports.  It is important to note that for each Shared Storage Datastore I created a new VM in the exact specifications as above via Template and  aligned all disks to 64k. For the connection to the storage I only had 1 extra 1gbe Nic per server.  Then in ESXi I created a seperate standard vSwitch just for iSCSI/NFS traffic.  If you are interested in the setup of my lab infrastructure please <a href="http://www.twitter.com/eczerwin">Contact me</a> and I will be happy to go more indepth.</p>

<p><strong>Testing Method and Results Collection</strong></p>

<p>After playing around with Iometer for some time and searching around to find a standard I decided to use the tests from the very popular VMware communities <a href="http://communities.vmware.com/thread/73745">Open unofficial storage performance thread</a>.  The exact ICF file I used can also be found there for download if you would like to do some of your own tests.  Regardless of the age of some of the posts I still think this is the most relevent and fair measure possible.  These tests include</p>

<ul>
<li><p>Max Throughput-100% Read</p></li>

<li><p>RealLife-60% random - 65% Read</p></li>

<li><p>Max Throughput-50% Read</p></li>

<li><p>Random-8k 70% Read</p></li>
</ul>

<p>First important thing to mention is only the VM generating the load was powered on during each test so there should be no skewing based on this. I put the IOmeter files into a set of Excel bar graphs.  I decided to base my results on what I call the big 3; Total IOps, MBps, and Average latency.</p>

<p><strong>NFS Final Performance Results</strong></p>

<p><em><strong>NFS Max Throughput 100% Read</strong></em></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS100ReadIOps.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS100ReadIOps.jpg" alt="" /></a></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS100ReadMBps.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS100ReadMBps.jpg" alt="" /></a></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS100ReadART.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS100ReadART.jpg" alt="" /></a></p>

<p><em><strong> RealLife-60% random - 65% Read</strong></em></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS60RandomIOps1.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS60RandomIOps1.jpg" alt="" /></a>
<a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS60RandMBps.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS60RandMBps.jpg" alt="" /></a></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS60RandART.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS60RandART.jpg" alt="" /></a></p>

<p><em><strong>Max Throughput-50% Read</strong></em></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS50ReadIOps.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS50ReadIOps.jpg" alt="" /></a></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS50ReadMBps.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS50ReadMBps.jpg" alt="" /></a></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS50ReadART.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS50ReadART.jpg" alt="" /></a></p>

<p><em><strong>Random-8k 70% Read</strong></em></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS70RandIOps.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS70RandIOps.jpg" alt="" /></a></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS70RandMBps.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS70RandMBps.jpg" alt="" /></a></p>

<p><a href="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS70RandART.jpg"><img src="http://vninja.net/wordpress/wp-content/uploads/2011/07/NFS70RandART.jpg" alt="" /></a></p>

<p><strong>Final Conclusions For NFS and closing</strong></p>

<p>As you may have noticed by the assorted graphs the two winners to come out in the NFS performance tests were QNAP and Synology.  QNAP appears to be slightly better at more Random workloads such as a real life vSphere environment and Synology seems to be way ahead of most of the arrays with solid sequential storage access - which would be perfect for a backup device.  However, they all seem to have high Average Response Times during Random workloads which in my opinon makes or breaks how well an environment runs.  From this first look I would say most of these NAS devices would be just fine for shared storage in a very small lab environment, a possible backup target, or for something simple as a fileserver volume.  In my next post we can put it all together with the iSCSI results and declare the final winner of the <strong>SMB Shared Storage Smackdown</strong>!!!</p>


  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=%2fposts%2fsmb-shared-storage-smackdown-part-1-nfs-performance%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=%2fposts%2fsmb-shared-storage-smackdown-part-1-nfs-performance%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fposts%2fsmb-shared-storage-smackdown-part-1-nfs-performance%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=%2fposts%2fsmb-shared-storage-smackdown-part-1-nfs-performance%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 ml-auto blog-sidebar">
  

  

  
  <section class="sidebar-module">
    <h4>Links</h4>
    <ol class="list-unstyled">
      
      <li><a href="https://example.com">Link 1</a></li>
      
      <li><a href="https://example.org">Link 2</a></li>
      
    </ol>
  </section>
  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->
    

    
    <footer class="blog-footer">
      <p>
      
      &copy; Christian Mohn
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>
    

  </body>

</html>
